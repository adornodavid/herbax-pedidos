<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos Herbax - Formulario Sencillo</title>
    <style>
        :root {
            --herbax-primary: #3fae29;
            --herbax-secondary: #c4d82e;
            --herbax-dark: #374E5A;
            --herbax-light: #f8fffe;
            --herbax-gray: #6b7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--herbax-light) 0%, #ffffff 100%);
            color: var(--herbax-dark);
            line-height: 1.6;
            font-size: 18px; /* Texto más grande para personas mayores */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 3rem;
            font-weight: bold;
            color: var(--herbax-primary);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--herbax-gray);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .support-info {
            background: var(--herbax-light);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--herbax-primary);
        }

        /* Nuevo sistema de pasos secuenciales */
        .step-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .step-container.active {
            display: block;
        }

        .step-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--herbax-light);
        }

        .step-number {
            background: var(--herbax-primary);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .step-title {
            font-size: 1.8rem;
            color: var(--herbax-primary);
            margin-bottom: 10px;
        }

        .step-description {
            color: var(--herbax-gray);
            font-size: 1.1rem;
        }

        /* Selector de país más grande y claro */
        .country-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .country-option {
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .country-option:hover {
            border-color: var(--herbax-primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(63, 174, 41, 0.2);
        }

        .country-option.selected {
            border-color: var(--herbax-primary);
            background: rgba(63, 174, 41, 0.05);
        }

        .country-option.selected::after {
            content: "✓";
            position: absolute;
            top: 15px;
            right: 20px;
            background: var(--herbax-primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .country-flag {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .country-name {
            font-weight: 600;
            color: var(--herbax-dark);
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .country-currency {
            color: var(--herbax-gray);
            font-size: 1.1rem;
        }

        /* Formularios más grandes y claros */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--herbax-dark);
            font-size: 1.1rem;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--herbax-primary);
            box-shadow: 0 0 0 3px rgba(63, 174, 41, 0.1);
        }

        .search-container {
            position: relative;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--herbax-primary);
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .search-result:hover {
            background: var(--herbax-light);
        }

        .help-text {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 1rem;
        }

        .help-text strong {
            color: #92400e;
        }

        /* Botones más grandes y claros */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: var(--herbax-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2d8a1f;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .button-group {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--herbax-light);
        }

        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--herbax-primary);
            height: 100%;
            transition: width 0.3s ease;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--herbax-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Productos con diseño más simple */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .product-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            border-color: var(--herbax-primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-name {
            font-weight: 600;
            color: var(--herbax-dark);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .product-sku {
            color: var(--herbax-gray);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--herbax-primary);
            margin-bottom: 15px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .quantity-btn {
            background: var(--herbax-primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 5px;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .country-grid {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
         Header simplificado 
        <div class="header">
            <div class="logo">Herbax</div>
            <div class="subtitle">Sistema de Pedidos - Formulario Sencillo</div>
            <div class="support-info">
                <strong>¿Necesitas ayuda?</strong><br>
                Llama al Centro de Atención CADI: <strong>800 649 0653</strong>
            </div>
        </div>

         Actualizando barra de progreso para 5 pasos 
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 20%"></div>
        </div>

         Paso 1: Selección de País 
        <div class="step-container active" id="step1">
            <div class="step-header">
                <div class="step-number">1</div>
                <h2 class="step-title">Selecciona tu País</h2>
                <p class="step-description">
                    Primero necesitamos saber desde qué país nos estás escribiendo.<br>
                    Esto nos ayudará a mostrarte los productos y precios correctos.
                </p>
                <p class="text-sm text-gray-600 mt-2"><strong>Sistema exclusivo para Centros de Distribución</strong></p>
            </div>

            <div class="country-grid">
                <div class="country-option" data-country="mexico" data-currency="MXN" data-symbol="$">
                    <div class="country-flag">🇲🇽</div>
                    <div class="country-name">México</div>
                    <div class="country-currency">Precios en Pesos Mexicanos</div>
                </div>
                <div class="country-option" data-country="guatemala" data-currency="GTQ" data-symbol="Q">
                    <div class="country-flag">🇬🇹</div>
                    <div class="country-name">Guatemala</div>
                    <div class="country-currency">Precios en Quetzales</div>
                </div>
                <div class="country-option" data-country="usa" data-currency="USD" data-symbol="$">
                    <div class="country-flag">🇺🇸</div>
                    <div class="country-name">Estados Unidos</div>
                    <div class="country-currency">Precios en Dólares</div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="nextStep1" disabled>
                    Continuar al Paso 2 →
                </button>
            </div>
        </div>

         Agregando Paso 2: Selección de Almacén 
         Paso 2: Selección de Almacén/Centro de Distribución 
        <div class="step-container" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <h2 class="step-title">Selecciona tu Centro de Distribución</h2>
                <p class="step-description">
                    Ahora necesitamos saber a qué almacén o centro de distribución perteneces.<br>
                    Puedes buscarlo o llenar los datos manualmente.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar mi Centro de Distribución</label>
                <div class="search-container">
                    <input type="text" class="form-input" id="warehouseSearch" 
                           placeholder="Escribe el nombre del almacén o ciudad">
                    <div class="search-results" id="warehouseSearchResults"></div>
                </div>
                <div class="help-text">
                    <strong>Ejemplos de búsqueda:</strong><br>
                    • Por ciudad: "Monterrey", "Ciudad de México", "Guadalajara"<br>
                    • Por nombre: "Almacén Central", "Centro Norte"
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre del Almacén *</label>
                <input type="text" class="form-input" id="warehouseName" required>
            </div>

            <div class="form-group">
                <label class="form-label">Ciudad *</label>
                <input type="text" class="form-input" id="warehouseCity" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo del Almacén *</label>
                <input type="email" class="form-input" id="warehouseEmail" required>
            </div>

            <div class="form-group">
                <label class="form-label">Teléfono del Almacén *</label>
                <input type="tel" class="form-input" id="warehousePhone" required>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep2">← Regresar</button>
                <button class="btn btn-primary" id="nextStep2">Continuar al Paso 3 →</button>
            </div>
        </div>

         Cambiando Paso 2 a Paso 3: Información del Distribuidor 
         Paso 3: Información del Distribuidor 
        <div class="step-container" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <h2 class="step-title">Información del Distribuidor</h2>
                <p class="step-description">
                    Ahora necesitamos tus datos como distribuidor de Herbax.<br>
                    Si ya eres distribuidor, puedes buscar tu información para que se llene automáticamente.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar mi información de distribuidor</label>
                <div class="search-container">
                    <input type="text" class="form-input" id="distributorSearch" 
                           placeholder="Escribe tu ID de distribuidor, nombre, teléfono o correo">
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="help-text">
                    <strong>¿Cómo es mi ID de distribuidor?</strong><br>
                    • México: Empieza con PMX (ejemplo: PMX001)<br>
                    • Guatemala: Empieza con PGUA (ejemplo: PGUA001)<br>
                    • Estados Unidos: Empieza con PUSA (ejemplo: PUSA001)
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ID de Distribuidor *</label>
                <input type="text" class="form-input" id="distributorId" required>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre Completo *</label>
                <input type="text" class="form-input" id="distributorName" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo Electrónico *</label>
                <input type="email" class="form-input" id="distributorEmail" required>
            </div>

            <div class="form-group">
                <label class="form-label">Confirmar Correo Electrónico *</label>
                <input type="email" class="form-input" id="distributorEmailConfirm" required>
            </div>

            <div class="form-group">
                <label class="form-label">Teléfono *</label>
                <input type="tel" class="form-input" id="distributorPhone" required>
            </div>

            <div class="form-group">
                <label class="form-label">Dirección *</label>
                <input type="text" class="form-input" id="distributorAddress" required>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep3">← Regresar</button>
                <button class="btn btn-primary" id="nextStep3">Continuar al Paso 4 →</button>
            </div>
        </div>

         Cambiando Paso 3 a Paso 4: Selección de Productos con buscador 
         Paso 4: Selección de Productos 
        <div class="step-container" id="step4">
            <div class="step-header">
                <div class="step-number">4</div>
                <h2 class="step-title">Selecciona tus Productos</h2>
                <p class="step-description">
                    Aquí puedes elegir los productos que deseas ordenar.<br>
                    Los precios mostrados son <strong>SIN impuestos</strong>.
                </p>
            </div>

             Agregando buscador de productos 
            <div class="form-group">
                <label class="form-label">Buscar productos</label>
                <input type="text" class="form-input" id="productSearch" 
                       placeholder="Busca por nombre del producto o SKU (ejemplo: RIM, 26-02, Magnotun)">
                <div class="help-text">
                    <strong>Tip:</strong> Puedes buscar por nombre del producto o por su código SKU
                </div>
            </div>

            <div id="productList" class="product-grid">
                 Los productos se cargarán aquí 
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep4">← Regresar</button>
                <button class="btn btn-primary" id="nextStep4">Ver Resumen del Pedido →</button>
            </div>
        </div>

         Cambiando Paso 4 a Paso 5: Confirmación 
         Paso 5: Confirmación 
        <div class="step-container" id="step5">
            <div class="step-header">
                <div class="step-number">5</div>
                <h2 class="step-title">Confirma tu Pedido</h2>
                <p class="step-description">
                    Revisa que toda la información esté correcta antes de enviar tu pedido.
                </p>
            </div>

            <div id="orderSummary">
                 El resumen se cargará aquí 
            </div>

            <div class="form-group">
                <label class="form-label">Método de Pago *</label>
                <select class="form-input" id="paymentMethod" required>
                    <option value="">Selecciona un método de pago</option>
                    <option value="referencia">Referencia Bancaria Santander</option>
                    <option value="deposito">Depósito Bancario Banregio</option>
                </select>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep5">← Regresar</button>
                <button class="btn btn-primary" id="submitOrder">Enviar Pedido</button>
            </div>
        </div>

         Pantalla de carga 
        <div class="loading" id="loadingScreen">
            <div class="spinner"></div>
            <h3>Enviando tu pedido...</h3>
            <p>Por favor espera un momento</p>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx';
        
        let currentStep = 1;
        let selectedCountry = null;
        let selectedCurrency = null;
        let selectedSymbol = null;
        let cart = [];
        let distributorData = {};
        let warehouseData = {}; // Agregando datos de almacén

        const sampleWarehouses = {
            mexico: [
                { name: "CADI Monterrey", city: "Monterrey, N.L.", email: "monterrey@herbax.com", phone: "800-649-0653", code: "MTY01" },
                { name: "CADI Ciudad de México", city: "Ciudad de México", email: "cdmx@herbax.com", phone: "800-649-0653", code: "CDMX01" },
                { name: "CADI Guadalajara", city: "Guadalajara, Jal.", email: "guadalajara@herbax.com", phone: "800-649-0653", code: "GDL01" },
                { name: "CADI Tijuana", city: "Tijuana, B.C.", email: "tijuana@herbax.com", phone: "800-649-0653", code: "TIJ01" },
                { name: "CADI Puebla", city: "Puebla, Pue.", email: "puebla@herbax.com", phone: "800-649-0653", code: "PUE01" },
                { name: "CADI Mérida", city: "Mérida, Yuc.", email: "merida@herbax.com", phone: "800-649-0653", code: "MER01" },
                { name: "CADI León", city: "León, Gto.", email: "leon@herbax.com", phone: "800-649-0653", code: "LEO01" },
                { name: "CADI Cancún", city: "Cancún, Q.R.", email: "cancun@herbax.com", phone: "800-649-0653", code: "CUN01" }
            ],
            guatemala: [
                { name: "Centro Herbax Guatemala", city: "Ciudad de Guatemala", email: "guatemala@herbax.com", phone: "+502-2345-6789", code: "GT01" },
                { name: "Herbax Quetzaltenango", city: "Quetzaltenango", email: "quetzal@herbax.com", phone: "+502-2345-6789", code: "GT02" },
                { name: "Herbax Escuintla", city: "Escuintla", email: "escuintla@herbax.com", phone: "+502-2345-6789", code: "GT03" },
                { name: "Herbax Antigua", city: "Antigua Guatemala", email: "antigua@herbax.com", phone: "+502-2345-6789", code: "GT04" }
            ],
            usa: [
                { name: "Herbax Distribution Miami", city: "Miami, FL", email: "miami@herbax.com", phone: "+1-800-HERBAX", code: "MIA01" },
                { name: "Herbax Los Angeles", city: "Los Angeles, CA", email: "losangeles@herbax.com", phone: "+1-800-HERBAX", code: "LAX01" },
                { name: "Herbax Houston", city: "Houston, TX", email: "houston@herbax.com", phone: "+1-800-HERBAX", code: "HOU01" },
                { name: "Herbax New York", city: "New York, NY", email: "newyork@herbax.com", phone: "+1-800-HERBAX", code: "NYC01" },
                { name: "Herbax Chicago", city: "Chicago, IL", email: "chicago@herbax.com", phone: "+1-800-HERBAX", code: "CHI01" }
            ]
        };

        const sampleDistributors = [
            // *** DISTRIBUIDOR DE PRUEBA - SOLO PARA TESTING ***
            {
                id: "PMX001",
                name: "David Adorno (PRUEBA)",
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "mexico",
                address: "Eje Exterior 14, Via Cordillera, Nuevo León, 66196",
                isPrueba: true
            },
            {
                id: "PGUA001", 
                name: "David Adorno (PRUEBA)",
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "guatemala",
                address: "Eje Exterior 14, Via Cordillera, Guatemala, 01001",
                isPrueba: true
            },
            {
                id: "PUSA001",
                name: "David Adorno (PRUEBA)", 
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "usa",
                address: "Eje Exterior 14, Via Cordillera, Texas, 66196",
                isPrueba: true
            },
            
            // *** DISTRIBUIDORES REALES DE MÉXICO ***
            {
                id: "PMX066",
                name: "María Elena González Hernández",
                email: "maria.gonzalez@herbax.com",
                phone: "5512345678",
                country: "mexico",
                address: "Av. Insurgentes Sur 1234, Col. Del Valle, CDMX, 03100"
            },
            {
                id: "PMX067",
                name: "Carlos Alberto Rodríguez López",
                email: "carlos.rodriguez@herbax.com",
                phone: "8187654321",
                country: "mexico",
                address: "Blvd. Díaz Ordaz 456, Col. Santa María, Monterrey, N.L., 64650"
            },
            {
                id: "PMX068",
                name: "Ana Patricia Morales Jiménez",
                email: "ana.morales@herbax.com",
                phone: "3398765432",
                country: "mexico",
                address: "Av. López Mateos Sur 789, Col. Providencia, Guadalajara, Jal., 44630"
            },
            {
                id: "PMX069",
                name: "José Luis Hernández Vázquez",
                email: "jose.hernandez@herbax.com",
                phone: "2228765432",
                country: "mexico",
                address: "16 de Septiembre 321, Centro, Puebla, Pue., 72000"
            },
            {
                id: "PMX070",
                name: "Laura Beatriz Sánchez Ruiz",
                email: "laura.sanchez@herbax.com",
                phone: "9999876543",
                country: "mexico",
                address: "Calle 60 No. 456, Centro, Mérida, Yuc., 97000"
            },
            {
                id: "PMX071",
                name: "Roberto Carlos Mendoza Torres",
                email: "roberto.mendoza@herbax.com",
                phone: "6641234567",
                country: "mexico",
                address: "Av. Revolución 789, Zona Centro, Tijuana, B.C., 22000"
            },
            {
                id: "PMX072",
                name: "Claudia Alejandra Ramírez Flores",
                email: "claudia.ramirez@herbax.com",
                phone: "4771234567",
                country: "mexico",
                address: "Blvd. López Mateos 234, Centro, León, Gto., 37000"
            },
            {
                id: "PMX073",
                name: "Fernando Javier Castro Moreno",
                email: "fernando.castro@herbax.com",
                phone: "9981234567",
                country: "mexico",
                address: "Av. Tulum 567, SM 22, Cancún, Q.R., 77500"
            },

            // *** DISTRIBUIDORES REALES DE GUATEMALA ***
            {
                id: "PGUA002",
                name: "Roberto Antonio Méndez Castillo",
                email: "roberto.mendez@herbax.com.gt",
                phone: "50212345678",
                country: "guatemala",
                address: "6a Avenida 12-34, Zona 1, Ciudad de Guatemala"
            },
            {
                id: "PGUA003",
                name: "Sofía Isabel Herrera Morales",
                email: "sofia.herrera@herbax.com.gt",
                phone: "50287654321",
                country: "guatemala",
                address: "15 Calle 8-45, Zona 10, Ciudad de Guatemala"
            },
            {
                id: "PGUA004",
                name: "Mario Alejandro López Pérez",
                email: "mario.lopez@herbax.com.gt",
                phone: "50298765432",
                country: "guatemala",
                address: "4a Calle 15-67, Zona 9, Ciudad de Guatemala"
            },
            {
                id: "PGUA005",
                name: "Carmen Lucía Rodríguez García",
                email: "carmen.rodriguez@herbax.com.gt",
                phone: "50276543210",
                country: "guatemala",
                address: "12 Avenida 23-45, Quetzaltenango"
            },
            {
                id: "PGUA006",
                name: "Diego Fernando Morales Vásquez",
                email: "diego.morales@herbax.com.gt",
                phone: "50265432109",
                country: "guatemala",
                address: "8a Calle 34-56, Escuintla"
            },

            // *** DISTRIBUIDORES REALES DE USA ***
            {
                id: "PUSA002",
                name: "Michael Anthony Johnson",
                email: "michael.johnson@herbax.com",
                phone: "3051234567",
                country: "usa",
                address: "1234 Ocean Drive, Miami Beach, FL 33139"
            },
            {
                id: "PUSA003",
                name: "Jennifer Marie Martinez",
                email: "jennifer.martinez@herbax.com",
                phone: "2137654321",
                country: "usa",
                address: "5678 Sunset Blvd, Los Angeles, CA 90028"
            },
            {
                id: "PUSA004",
                name: "David Christopher Wilson",
                email: "david.wilson@herbax.com",
                phone: "7138765432",
                country: "usa",
                address: "9012 Main Street, Houston, TX 77002"
            },
            {
                id: "PUSA005",
                name: "Sarah Elizabeth Brown",
                email: "sarah.brown@herbax.com",
                phone: "2129876543",
                country: "usa",
                address: "3456 Broadway, New York, NY 10018"
            },
            {
                id: "PUSA006",
                name: "Robert James Davis",
                email: "robert.davis@herbax.com",
                phone: "3125432109",
                country: "usa",
                address: "7890 Michigan Ave, Chicago, IL 60611"
            }

        ];

        const productData = {
            mexico: [
                { sku: "1", name: "Difest", price: 292.24, qualifyingPoints: 42.38, commissionablePoints: 36.53 },
                { sku: "1A", name: "Vitamina C", price: 223.28, qualifyingPoints: 32.38, commissionablePoints: 27.91 },
                { sku: "2-03", name: "Rim Plus", price: 327.59, qualifyingPoints: 47.50, commissionablePoints: 40.95 },
                { sku: "4", name: "Cobex", price: 219.83, qualifyingPoints: 31.88, commissionablePoints: 27.48 },
                { sku: "4A", name: "Igniflex", price: 299.24, qualifyingPoints: 42.38, commissionablePoints: 36.53 },
                { sku: "5D-09", name: "Dexel Plus Keto", price: 464.66, qualifyingPoints: 67.38, commissionablePoints: 58.08 },
                { sku: "5D-11", name: "Dexel Plus", price: 412.93, qualifyingPoints: 59.88, commissionablePoints: 51.62 },
                { sku: "6", name: "Diabet", price: 219.83, qualifyingPoints: 31.88, commissionablePoints: 27.48 },
                { sku: "7", name: "Tesy", price: 223.28, qualifyingPoints: 32.38, commissionablePoints: 27.91 },
                { sku: "8A-01", name: "BrioReal Max", price: 223.69, qualifyingPoints: 32.44, commissionablePoints: 27.96 }
            ],
            guatemala: [
                { sku: "26-02", name: "RIM", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "09-03", name: "TESY", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "25-02", name: "HIVY 89", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "06-02", name: "DIABET", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "10-03", name: "GATILOE", price: 177.67, qualifyingPoints: 49.75, commissionablePoints: 39.72 },
                { sku: "36A-02", name: "CILCO-LIFE", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 }
            ],
            usa: [
                { sku: "01-02", name: "DIFEST-1", price: 23.69, qualifyingPoints: 39.48, commissionablePoints: 39.48 },
                { sku: "1A", name: "GATILOE-10", price: 25.79, qualifyingPoints: 42.98, commissionablePoints: 42.98 },
                { sku: "11-03", name: "HIPEN-11", price: 15.49, qualifyingPoints: 25.82, commissionablePoints: 25.82 },
                { sku: "13-02", name: "DONDX-13", price: 15.49, qualifyingPoints: 25.82, commissionablePoints: 25.82 },
                { sku: "131A-01", name: "Magnotun 7s Box with 30 envelopes 7g ea.", price: 50.49, qualifyingPoints: 84.15, commissionablePoints: 84.15 }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
        });

        function initializeEventListeners() {
            // Selección de país
            document.querySelectorAll('.country-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectCountry(this);
                });
            });

            // Botones de navegación
            document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep2').addEventListener('click', () => goToStep(3));
            document.getElementById('nextStep3').addEventListener('click', () => goToStep(4));
            document.getElementById('nextStep4').addEventListener('click', () => goToStep(5));
            
            document.getElementById('backStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('backStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('backStep4').addEventListener('click', () => goToStep(3));
            document.getElementById('backStep5').addEventListener('click', () => goToStep(4));

            // Búsqueda de almacén
            document.getElementById('warehouseSearch').addEventListener('input', searchWarehouse);
            
            // Búsqueda de distribuidor
            document.getElementById('distributorSearch').addEventListener('input', searchDistributor);
            
            // Búsqueda de productos
            document.getElementById('productSearch').addEventListener('input', searchProducts);
            
            // Envío de pedido
            document.getElementById('submitOrder').addEventListener('click', submitOrder);
        }

        function selectCountry(element) {
            // Remover selección anterior
            document.querySelectorAll('.country-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Seleccionar nuevo país
            element.classList.add('selected');
            
            selectedCountry = element.dataset.country;
            selectedCurrency = element.dataset.currency;
            selectedSymbol = element.dataset.symbol;
            
            // Habilitar botón siguiente
            document.getElementById('nextStep1').disabled = false;
        }

        function goToStep(step) {
            // Validar paso actual antes de continuar
            if (!validateCurrentStep()) {
                return;
            }

            // Ocultar todos los pasos
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Mostrar paso actual
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // Actualizar barra de progreso
            const progress = (step / 5) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Cargar contenido específico del paso
            if (step === 4) {
                loadProducts();
            } else if (step === 5) {
                loadOrderSummary();
            }
        }

        function validateCurrentStep() {
            if (currentStep === 1) {
                return selectedCountry !== null;
            } else if (currentStep === 2) {
                const name = document.getElementById('warehouseName').value;
                const city = document.getElementById('warehouseCity').value;
                const email = document.getElementById('warehouseEmail').value;
                const phone = document.getElementById('warehousePhone').value;
                
                if (!name || !city || !email || !phone) {
                    alert('Por favor completa todos los campos del almacén.');
                    return false;
                }
                
                warehouseData = { name, city, email, phone };
                return true;
            } else if (currentStep === 3) {
                const id = document.getElementById('distributorId').value;
                const name = document.getElementById('distributorName').value;
                const email = document.getElementById('distributorEmail').value;
                const emailConfirm = document.getElementById('distributorEmailConfirm').value;
                const phone = document.getElementById('distributorPhone').value;
                const address = document.getElementById('distributorAddress').value;
                
                if (!id || !name || !email || !emailConfirm || !phone || !address) {
                    alert('Por favor completa todos los campos obligatorios.');
                    return false;
                }
                
                if (email !== emailConfirm) {
                    alert('Los correos electrónicos no coinciden.');
                    return false;
                }
                
                distributorData = { id, name, email, phone, address };
                return true;
            } else if (currentStep === 4) {
                if (cart.length === 0) {
                    alert('Por favor selecciona al menos un producto.');
                    return false;
                }
                return true;
            }
            return true;
        }

        function searchWarehouse() {
            const query = this.value.toLowerCase();
            const results = document.getElementById('warehouseSearchResults');
            
            if (query.length < 2) {
                results.style.display = 'none';
                return;
            }
            
            const warehouses = sampleWarehouses[selectedCountry] || [];
            const filteredWarehouses = warehouses.filter(warehouse => 
                warehouse.name.toLowerCase().includes(query) ||
                warehouse.city.toLowerCase().includes(query)
            );
            
            if (filteredWarehouses.length > 0) {
                results.innerHTML = filteredWarehouses.map(warehouse => 
                    `<div class="search-result" onclick="selectWarehouse('${warehouse.name}', '${warehouse.city}', '${warehouse.email}', '${warehouse.phone}')">
                        <strong>${warehouse.name}</strong><br>
                        <small>${warehouse.city} | ${warehouse.email} | ${warehouse.phone}</small>
                    </div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        }

        function selectWarehouse(name, city, email, phone) {
            document.getElementById('warehouseName').value = name;
            document.getElementById('warehouseCity').value = city;
            document.getElementById('warehouseEmail').value = email;
            document.getElementById('warehousePhone').value = phone;
            document.getElementById('warehouseSearchResults').style.display = 'none';
        }

        function searchDistributor() {
            const query = this.value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (query.length < 2) {
                results.style.display = 'none';
                return;
            }
            
            const filteredDistributors = sampleDistributors.filter(dist => 
                dist.country === selectedCountry &&
                (dist.id.toLowerCase().includes(query) ||
                 dist.name.toLowerCase().includes(query) ||
                 dist.email.toLowerCase().includes(query) ||
                 dist.phone.includes(query))
            );
            
            if (filteredDistributors.length > 0) {
                results.innerHTML = filteredDistributors.map(dist => 
                    `<div class="search-result" onclick="selectDistributor('${dist.id}')">
                        <strong>${dist.id}</strong> - ${dist.name}<br>
                        <small>${dist.email} | ${dist.phone}</small>
                    </div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        }

        function selectDistributor(id) {
            const distributor = sampleDistributors.find(d => d.id === id);
            if (distributor) {
                document.getElementById('distributorId').value = distributor.id;
                document.getElementById('distributorName').value = distributor.name;
                document.getElementById('distributorEmail').value = distributor.email;
                document.getElementById('distributorEmailConfirm').value = distributor.email;
                document.getElementById('distributorPhone').value = distributor.phone;
                document.getElementById('distributorAddress').value = distributor.address;
                document.getElementById('searchResults').style.display = 'none';
            }
        }

        function searchProducts() {
            const query = this.value.toLowerCase();
            const products = productData[selectedCountry] || [];
            
            if (query.length === 0) {
                loadProducts(); // Mostrar todos los productos
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(query) ||
                product.sku.toLowerCase().includes(query)
            );
            
            displayProducts(filteredProducts);
        }

        function loadProducts() {
            const products = productData[selectedCountry] || [];
            displayProducts(products);
        }

        function displayProducts(products) {
            const productList = document.getElementById('productList');
            
            if (products.length === 0) {
                productList.innerHTML = '<p style="text-align: center; color: var(--herbax-gray);">No se encontraron productos con esa búsqueda.</p>';
                return;
            }
            
            productList.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-name">${product.name}</div>
                    <div class="product-sku">SKU: ${product.sku}</div>
                    <div class="product-price">${selectedSymbol}${product.price.toFixed(2)} <small>(SIN impuestos)</small></div>
                    <div style="font-size: 0.9rem; color: var(--herbax-gray); margin: 5px 0;">
                        Puntos Calificables: ${product.qualifyingPoints} | Comisionables: ${product.commissionablePoints}
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="changeQuantity('${product.sku}', -1)">-</button>
                        <input type="number" class="quantity-input" id="qty-${product.sku}" value="${getCartQuantity(product.sku)}" min="0" 
                               onchange="updateQuantity('${product.sku}', this.value)">
                        <button class="quantity-btn" onclick="changeQuantity('${product.sku}', 1)">+</button>
                    </div>
                </div>
            `).join('');
        }

        function getCartQuantity(sku) {
            const item = cart.find(item => item.sku === sku);
            return item ? item.quantity : 0;
        }

        function changeQuantity(sku, change) {
            const input = document.getElementById(`qty-${sku}`);
            const newValue = Math.max(0, parseInt(input.value) + change);
            input.value = newValue;
            updateQuantity(sku, newValue);
        }

        function updateQuantity(sku, quantity) {
            const product = productData[selectedCountry].find(p => p.sku === sku);
            if (!product) return;
            
            const existingIndex = cart.findIndex(item => item.sku === sku);
            
            if (quantity > 0) {
                if (existingIndex >= 0) {
                    cart[existingIndex].quantity = parseInt(quantity);
                } else {
                    cart.push({
                        sku: product.sku,
                        name: product.name,
                        price: product.price,
                        quantity: parseInt(quantity),
                        qualifyingPoints: product.qualifyingPoints,
                        commissionablePoints: product.commissionablePoints
                    });
                }
            } else {
                if (existingIndex >= 0) {
                    cart.splice(existingIndex, 1);
                }
            }
        }

        function loadOrderSummary() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalQualifyingPoints = cart.reduce((sum, item) => sum + (item.qualifyingPoints * item.quantity), 0);
            const totalCommissionablePoints = cart.reduce((sum, item) => sum + (item.commissionablePoints * item.quantity), 0);
            
            let discountNotice = '';
            if (selectedCountry === 'usa' && total >= 1000) {
                discountNotice = `
                    <div style="background: #d1fae5; border: 2px solid #10b981; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <strong>🎉 ¡Descuento Aplicado!</strong><br>
                        Tu pedido es mayor a $1,000 USD, por lo que recibes precios especiales con descuento.
                    </div>
                `;
            }
            
            document.getElementById('orderSummary').innerHTML = `
                ${discountNotice}
                
                <div style="background: #f9fafb; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">📋 Resumen del Pedido</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>País:</strong> ${selectedCountry === 'mexico' ? 'México' : selectedCountry === 'guatemala' ? 'Guatemala' : 'Estados Unidos'}<br>
                        <strong>Almacén:</strong> ${warehouseData.name} - ${warehouseData.city}<br>
                        <strong>Correo Almacén:</strong> ${warehouseData.email}<br>
                        <strong>Teléfono Almacén:</strong> ${warehouseData.phone}<br><br>
                        <strong>Distribuidor:</strong> ${distributorData.name} (${distributorData.id})<br>
                        <strong>Correo Distribuidor:</strong> ${distributorData.email}<br>
                        <strong>Teléfono Distribuidor:</strong> ${distributorData.phone}<br>
                        <strong>Dirección Distribuidor:</strong> ${distributorData.address}
                    </div>
                    
                    <h4 style="margin-bottom: 15px;">Productos:</h4>
                    ${cart.map(item => `
                        <div style="border-bottom: 1px solid #e5e7eb; padding: 10px 0;">
                            <strong>${item.name}</strong> (SKU: ${item.sku})<br>
                            Cantidad: ${item.quantity} × ${selectedSymbol}${item.price.toFixed(2)} = ${selectedSymbol}${(item.price * item.quantity).toFixed(2)}
                        </div>
                    `).join('')}
                    
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--herbax-primary);">
                        <div style="font-size: 1.2rem;"><strong>Total: ${selectedSymbol}${total.toFixed(2)} (SIN impuestos)</strong></div>
                        <div style="margin-top: 10px;">
                            <strong>Puntos Calificables:</strong> ${totalQualifyingPoints.toFixed(2)}<br>
                            <strong>Puntos Comisionables:</strong> ${totalCommissionablePoints.toFixed(2)}
                        </div>
                    </div>
                </div>
            `;
        }

        async function submitOrder() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            if (!paymentMethod) {
                alert('Por favor selecciona un método de pago.');
                return;
            }
            
            document.getElementById('loadingScreen').style.display = 'block';
            document.getElementById('step5').style.display = 'none';
            
            const orderData = {
                country: selectedCountry,
                currency: selectedCurrency,
                warehouse: warehouseData, // Agregando datos de almacén
                distributor: distributorData,
                products: cart,
                paymentMethod: paymentMethod,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                totalQualifyingPoints: cart.reduce((sum, item) => sum + (item.qualifyingPoints * item.quantity), 0),
                totalCommissionablePoints: cart.reduce((sum, item) => sum + (item.commissionablePoints * item.quantity), 0),
                timestamp: new Date().toISOString()
            };
            
            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (response.ok) {
                    alert('¡Pedido enviado exitosamente! Recibirás una confirmación por correo electrónico.');
                    location.reload();
                } else {
                    throw new Error('Error en el servidor');
                }
            } catch (error) {
                alert('Hubo un error al enviar el pedido. Por favor intenta nuevamente o contacta al soporte.');
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('step5').style.display = 'block';
            }
        }
    </script>
</body>
</html>
