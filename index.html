<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale: 1.0">
    <title>Sistema de Pedidos HBX - Portal Distribuidores</title>
    <style>
        :root {
            --herbax-primary: #3fae29;
            --herbax-secondary: #c4d82e;
            --herbax-gray: #374E5A;
            --herbax-light: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header m√°s limpio y minimalista como en v23 */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 3rem;
            color: var(--herbax-primary);
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            color: #666;
            font-weight: 400;
        }

        /* Secci√≥n de ayuda con borde verde lateral como en v23 */
        .help-banner {
            background: #f9f9f9;
            border-left: 4px solid var(--herbax-primary);
            padding: 20px;
            margin-bottom: 40px;
            color: #555;
        }

        .help-banner strong {
            color: var(--herbax-gray);
        }

        /* Barra de progreso m√°s simple y limpia */
        .progress-bar {
            background: #e5e7eb;
            height: 4px;
            border-radius: 2px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--herbax-primary);
            height: 100%;
            transition: width 0.3s ease;
        }

        /* Contenedores de pasos m√°s limpios sin sombras excesivas */
        .step-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            display: none;
        }

        .step-container.active {
            display: block;
        }

        /* Header de pasos m√°s minimalista */
        .step-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .step-number {
            background: var(--herbax-primary);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        .step-title {
            font-size: 2rem;
            color: var(--herbax-primary);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .step-description {
            color: #666;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Grid de pa√≠ses m√°s limpio */
        .country-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 40px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .country-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .country-option:hover {
            border-color: var(--herbax-primary);
            background: #f8fdf8;
        }

        .country-option.selected {
            border-color: var(--herbax-primary);
            background: #f0f9f0;
        }

        .country-flag {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .country-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--herbax-gray);
            margin-bottom: 5px;
        }

        .country-currency {
            color: #666;
            font-size: 0.95rem;
        }

        /* Formularios m√°s limpios */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--herbax-gray);
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--herbax-primary);
        }

        /* B√∫squedas m√°s limpias */
        .search-container {
            position: relative;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--herbax-primary);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .search-result {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .search-result:hover {
            background: #f8fdf8;
        }

        .help-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.5;
        }

        /* Botones m√°s limpios y minimalistas */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 140px;
        }

        .btn-primary {
            background: var(--herbax-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2d8a1f;
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        /* Cards de productos m√°s limpias */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .product-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            background: white;
        }

        .product-name {
            font-weight: 600;
            color: var(--herbax-primary);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .product-sku {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--herbax-gray);
            margin-bottom: 15px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--herbax-primary);
            background: white;
            color: var(--herbax-primary);
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .quantity-btn:hover {
            background: var(--herbax-primary);
            color: white;
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 6px;
        }

        /* Pantalla de confirmaci√≥n m√°s limpia */
        .confirmation-screen {
            display: none;
            text-align: center;
            padding: 40px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
        }

        .confirmation-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .confirmation-title {
            font-size: 2rem;
            color: var(--herbax-primary);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .confirmation-message {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .order-summary-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid #f0f0f0;
        }

        .back-to-home-btn {
            background: var(--herbax-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .back-to-home-btn:hover {
            background: #2d8a1f;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .step-container {
                padding: 25px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header simplificado como en v23 -->
        <div class="header">
            <h1 onclick="goToHome()">Herbax</h1>
            <p>Sistema de Pedidos - Formulario Sencillo</p>
        </div>

        <!-- Banner de ayuda con dise√±o lateral verde -->
        <div class="help-banner">
            <strong>¬øNecesitas ayuda?</strong><br>
            Llama al Centro de Atenci√≥n CADI: <strong>800 649 0653</strong>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 20%"></div>
        </div>

        <p style="font-size: 1.1rem; color: #666; margin-bottom: 20px;">Paso 1: Selecci√≥n de Pa√≠s</p>

         Paso 1: Selecci√≥n de Pa√≠s 
        <div class="step-container active" id="step1">
            <div class="step-header">
                <div class="step-number">1</div>
                <h2 class="step-title">Selecciona tu Pa√≠s</h2>
                <p class="step-description">
                    Primero necesitamos saber desde qu√© pa√≠s nos est√°s escribiendo.<br>
                    Esto nos ayudar√° a mostrarte los productos y precios correctos.
                </p>
                <p style="font-size: 1rem; color: var(--herbax-gray); margin-top: 15px; font-weight: 600;">Sistema exclusivo para Centros de Distribuci√≥n</p>
            </div>

            <div class="country-grid">
                <div class="country-option" data-country="mexico" data-currency="MXN" data-symbol="$">
                    <div class="country-flag">üá≤üáΩ</div>
                    <div class="country-name">M√©xico</div>
                    <div class="country-currency">Precios en Pesos Mexicanos</div>
                </div>
                <div class="country-option" data-country="guatemala" data-currency="GTQ" data-symbol="Q">
                    <div class="country-flag">üá¨üáπ</div>
                    <div class="country-name">Guatemala</div>
                    <div class="country-currency">Precios en Quetzales</div>
                </div>
                <div class="country-option" data-country="usa" data-currency="USD" data-symbol="$">
                    <div class="country-flag">üá∫üá∏</div>
                    <div class="country-name">Estados Unidos</div>
                    <div class="country-currency">Precios en D√≥lares</div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="nextStep1" disabled>
                    Continuar al Paso 2 ‚Üí
                </button>
            </div>
        </div>

         Paso 2: Selecci√≥n de Almac√©n 
        <div class="step-container" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <h2 class="step-title">Selecciona tu Centro de Distribuci√≥n</h2>
                <p class="step-description">
                    Ahora necesitamos saber a qu√© almac√©n o centro de distribuci√≥n perteneces.<br>
                    Puedes buscarlo o llenar los datos manualmente.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar mi Centro de Distribuci√≥n</label>
                <div class="search-container">
                    <input type="text" class="form-input" id="warehouseSearch" 
                           placeholder="Escribe el nombre del almac√©n o ciudad">
                    <div class="search-results" id="warehouseSearchResults"></div>
                </div>
                <div class="help-text">
                    <strong>Ejemplos de b√∫squeda:</strong><br>
                    ‚Ä¢ Por ciudad: "Monterrey", "Ciudad de M√©xico", "Guadalajara"<br>
                    ‚Ä¢ Por nombre: "Almac√©n Central", "Centro Norte"
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre del Almac√©n *</label>
                <input type="text" class="form-input" id="warehouseName" required>
            </div>

            <div class="form-group">
                <label class="form-label">Ciudad *</label>
                <input type="text" class="form-input" id="warehouseCity" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo del Almac√©n *</label>
                <input type="email" class="form-input" id="warehouseEmail" required>
            </div>

            <div class="form-group">
                <label class="form-label">Tel√©fono del Almac√©n *</label>
                <input type="tel" class="form-input" id="warehousePhone" required>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep2">‚Üê Regresar</button>
                <button class="btn btn-primary" id="nextStep2">Continuar al Paso 3 ‚Üí</button>
            </div>
        </div>

         Paso 3: Informaci√≥n del Distribuidor 
        <div class="step-container" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <h2 class="step-title">Informaci√≥n del Distribuidor</h2>
                <p class="step-description">
                    Ahora necesitamos tus datos como distribuidor de Herbax.<br>
                    Si ya eres distribuidor, puedes buscar tu informaci√≥n para que se llene autom√°ticamente.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar mi informaci√≥n de distribuidor</label>
                <div class="search-container">
                    <input type="text" class="form-input" id="distributorSearch" 
                           placeholder="Escribe tu ID de distribuidor, nombre, tel√©fono o correo">
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="help-text">
                    <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <h4 style="color: #92400e; margin-bottom: 10px; font-weight: bold;">¬øC√≥mo es mi ID de distribuidor?</h4>
                        <div style="color: #92400e; font-size: 0.9rem;">
                            <p>‚Ä¢ <strong>M√©xico:</strong> N√∫meros secuenciales (ejemplo: 66, 67, 68...)</p>
                            <p>‚Ä¢ <strong>Guatemala:</strong> Empieza con GT (ejemplo: GT002, GT003...)</p>
                            <p>‚Ä¢ <strong>Estados Unidos:</strong> Empieza con US (ejemplo: US002, US003...)</p>
                            <p style="font-size: 0.8rem; margin-top: 8px; font-style: italic;">* Los IDs que empiezan con "P" son solo para pruebas</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ID de Distribuidor *</label>
                <input type="text" class="form-input" id="distributorId" required>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre Completo *</label>
                <input type="text" class="form-input" id="distributorName" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo Electr√≥nico *</label>
                <input type="email" class="form-input" id="distributorEmail" required>
            </div>

            <div class="form-group">
                <label class="form-label">Confirmar Correo Electr√≥nico *</label>
                <input type="email" class="form-input" id="distributorEmailConfirm" required>
            </div>

            <div class="form-group">
                <label class="form-label">Tel√©fono *</label>
                <input type="tel" class="form-input" id="distributorPhone" required>
            </div>

            <div class="form-group">
                <label class="form-label">Direcci√≥n *</label>
                <input type="text" class="form-input" id="distributorAddress" required>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep3">‚Üê Regresar</button>
                <button class="btn btn-primary" id="nextStep3">Continuar al Paso 4 ‚Üí</button>
            </div>
        </div>

         Paso 4: Selecci√≥n de Productos 
        <div class="step-container" id="step4">
            <div class="step-header">
                <div class="step-number">4</div>
                <h2 class="step-title">Selecciona tus Productos</h2>
                <p class="step-description">
                    Aqu√≠ puedes elegir los productos que deseas ordenar.<br>
                    Los precios mostrados son <strong>SIN impuestos</strong>.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar productos</label>
                <input type="text" class="form-input" id="productSearch" 
                       placeholder="Busca por nombre del producto o SKU (ejemplo: RIM, 26-02, Magnotun)">
                <div class="help-text">
                    <strong>Tip:</strong> Puedes buscar por nombre del producto o por su c√≥digo SKU
                </div>
            </div>

            <div id="productList" class="product-grid">
                 Los productos se cargar√°n aqu√≠ 
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep4">‚Üê Regresar</button>
                <button class="btn btn-primary" id="nextStep4">Ver Resumen del Pedido ‚Üí</button>
            </div>
        </div>

         Paso 5: Confirmaci√≥n 
        <div class="step-container" id="step5">
            <div class="step-header">
                <div class="step-number">5</div>
                <h2 class="step-title">Confirma tu Pedido</h2>
                <p class="step-description">
                    Revisa que toda la informaci√≥n est√© correcta antes de enviar tu pedido.
                </p>
            </div>

            <div id="orderSummary">
                 El resumen se cargar√° aqu√≠ 
            </div>

            <div class="form-group">
                <label class="form-label">M√©todo de Pago *</label>
                <select class="form-input" id="paymentMethod" required>
                    <option value="">Selecciona un m√©todo de pago</option>
                    <option value="referencia">Referencia Bancaria Santander</option>
                    <option value="deposito">Dep√≥sito Bancario Banregio</option>
                    <option value="tarjeta">Tarjeta Bancaria</option>
                </select>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep5">‚Üê Regresar</button>
                <button class="btn btn-primary" id="submitOrder" disabled>Enviar Pedido</button>
            </div>
        </div>

         Pantalla de confirmaci√≥n 
        <div id="confirmationScreen" class="confirmation-screen">
            <div class="confirmation-icon">‚úÖ</div>
            <div class="confirmation-title">¬°Pedido Enviado Exitosamente!</div>
            <div class="confirmation-message">
                Tu pedido ha sido enviado correctamente y ser√° procesado por nuestro equipo.<br>
                Recibir√°s una confirmaci√≥n por correo electr√≥nico en breve.
            </div>
            
            <div class="order-summary-card">
                <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üìã Resumen de tu Pedido</h3>
                <div id="finalOrderSummary"></div>
            </div>

            <button class="back-to-home-btn" onclick="goToHome()">
                üè† Regresar al Inicio
            </button>
        </div>
    </div>

    <script>
        let selectedCountry = null;
        let selectedCurrency = null;
        let selectedSymbol = null;
        let currentStep = 1;
        let cart = [];

        // Funci√≥n para mostrar pasos
        function showStep(step) {
            console.log('[v0] Showing step:', step);
            
            // Ocultar todos los pasos
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Mostrar el paso actual
            const stepElement = document.getElementById(`step${step}`);
            if (stepElement) {
                stepElement.classList.add('active');
                currentStep = step;
            }
        }

        // Funci√≥n para seleccionar pa√≠s
        function selectCountry(country, currency, symbol) {
            console.log('[v0] Selecting country:', country);
            
            // Remover selecci√≥n anterior
            document.querySelectorAll('.country-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Seleccionar nuevo pa√≠s
            const selectedOption = document.querySelector(`[data-country="${country}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            selectedCountry = country;
            selectedCurrency = currency;
            selectedSymbol = symbol;
            
            // Habilitar bot√≥n siguiente
            const nextButton = document.getElementById('nextStep1');
            if (nextButton) {
                nextButton.disabled = false;
            }
            
            console.log('[v0] Country selected successfully:', selectedCountry);
        }

        // Funci√≥n para ir al siguiente paso
        function goToStep(step) {
            console.log('[v0] Going to step:', step);
            
            if (step === 2 && !selectedCountry) {
                alert('Por favor selecciona un pa√≠s primero');
                return;
            }
            
            showStep(step);
        }

        // Inicializaci√≥n cuando carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[v0] DOM loaded, setting up...');
            
            // Mostrar paso 1
            showStep(1);
            
            // Configurar event listeners para selecci√≥n de pa√≠s
            const countryOptions = document.querySelectorAll('.country-option');
            console.log('[v0] Found country options:', countryOptions.length);
            
            countryOptions.forEach(option => {
                option.addEventListener('click', function() {
                    console.log('[v0] Country option clicked:', this.dataset.country);
                    selectCountry(this.dataset.country, this.dataset.currency, this.dataset.symbol);
                });
            });
            
            // Configurar bot√≥n siguiente del paso 1
            const nextStep1 = document.getElementById('nextStep1');
            if (nextStep1) {
                nextStep1.addEventListener('click', function() {
                    console.log('[v0] Next step 1 clicked');
                    goToStep(2);
                });
            }
            
            console.log('[v0] Setup complete');
        });

        let warehouseData = {
            mexico: [
                { id: 'CADI-MTY', name: 'CADI Monterrey', city: 'Monterrey', email: 'monterrey@cadi.com', phone: '800-649-0653' },
                { id: 'CADI-CDMX', name: 'CADI Ciudad de M√©xico', city: 'Ciudad de M√©xico', email: 'cdmx@cadi.com', phone: '800-649-0653' },
                { id: 'CADI-GDL', name: 'CADI Guadalajara', city: 'Guadalajara', email: 'guadalajara@cadi.com', phone: '800-649-0653' },
                { id: 'CADI-TIJ', name: 'CADI Tijuana', city: 'Tijuana', email: 'tijuana@cadi.com', phone: '800-649-0653' }
            ],
            guatemala: [
                { id: 'HBX-GT01', name: 'Centro Guatemala Norte', city: 'Guatemala City', email: 'guatemala@herbax.com', phone: '+502-2345-6789' },
                { id: 'HBX-GT02', name: 'Centro Quetzaltenango', city: 'Quetzaltenango', email: 'quetzal@herbax.com', phone: '+502-7765-4321' }
            ],
            usa: [
                { id: 'HBX-US01', name: 'Distribution Center Miami', city: 'Miami', email: 'miami@herbax.com', phone: '+1-305-555-0123' },
                { id: 'HBX-US02', name: 'Distribution Center Los Angeles', city: 'Los Angeles', email: 'la@herbax.com', phone: '+1-213-555-0456' },
                { id: 'HBX-US03', name: 'Distribution Center Houston', city: 'Houston', email: 'houston@herbax.com', phone: '+1-713-555-0789' }
            ]
        };

        // Datos de distribuidores por pa√≠s
        let sampleDistributors = {
            mexico: [
                { id: 'PMX001', name: 'David Adorno (PRUEBA)', email: 'adorno.david@gmail.com', phone: '8110669931', address: 'Eje Exterior 14, Via Cordillera, Nuevo Le√≥n, 66196', country: 'Mexico' },
                { id: '66', name: 'Mar√≠a Elena Gonz√°lez Hern√°ndez', email: 'maria.gonzalez@herbax.com', phone: '5512345678', address: 'Av. Insurgentes 1234, Col. Roma Norte, CDMX, 06700', country: 'Mexico' },
                { id: '67', name: 'Carlos Roberto Mart√≠nez L√≥pez', email: 'carlos.martinez@herbax.com', phone: '3398765432', address: 'Calle Morelos 567, Col. Centro, Guadalajara, 44100', country: 'Mexico' },
                { id: '68', name: 'Ana Patricia Rodr√≠guez S√°nchez', email: 'ana.rodriguez@herbax.com', phone: '8187654321', address: 'Blvd. D√≠az Ordaz 890, Col. Santa Mar√≠a, Monterrey, 64650', country: 'Mexico' }
            ],
            guatemala: [
                { id: 'PGUA001', name: 'David Adorno (PRUEBA)', email: 'adorno.david@gmail.com', phone: '8110669931', address: 'Eje Exterior 14, Via Cordillera, Guatemala', country: 'Guatemala' },
                { id: 'GT002', name: 'Jos√© Manuel P√©rez Morales', email: 'jose.perez@herbax.com', phone: '+502-5555-1234', address: '12 Calle 3-45, Zona 1, Guatemala City', country: 'Guatemala' },
                { id: 'GT003', name: 'Carmen Luc√≠a Hern√°ndez V√°squez', email: 'carmen.hernandez@herbax.com', phone: '+502-4444-5678', address: '8va Avenida 15-20, Zona 9, Guatemala City', country: 'Guatemala' }
            ],
            usa: [
                { id: 'PUSA001', name: 'David Adorno (PRUEBA)', email: 'adorno.david@gmail.com', phone: '8110669931', address: 'Eje Exterior 14, Via Cordillera, Estados Unidos', country: 'Estados Unidos' },
                { id: 'US002', name: 'Michael Johnson Smith', email: 'michael.johnson@herbax.com', phone: '+1-305-555-9876', address: '1234 Ocean Drive, Miami Beach, FL 33139', country: 'Estados Unidos' },
                { id: 'US003', name: 'Jennifer Mar√≠a Garc√≠a', email: 'jennifer.garcia@herbax.com', phone: '+1-213-555-5432', address: '5678 Sunset Blvd, Los Angeles, CA 90028', country: 'Estados Unidos' }
            ]
        };

        // Datos de productos por pa√≠s (versi√≥n simplificada para testing)
        let productData = {
            mexico: [
                { sku: '1', name: 'Difest', price: 292.24, qualifyingPoints: 42.38, commissionPoints: 36.53 },
                { sku: '1A', name: 'Vitamina C', price: 223.28, qualifyingPoints: 32.38, commissionPoints: 27.91 },
                { sku: '2-03', name: 'Rim Plus', price: 327.59, qualifyingPoints: 47.50, commissionPoints: 40.95 },
                { sku: '4', name: 'Cobex', price: 219.83, qualifyingPoints: 31.88, commissionPoints: 27.48 }
            ],
            guatemala: [
                { sku: '26-02', name: 'RIM', price: 133.03, qualifyingPoints: 37.25, commissionPoints: 33.26 },
                { sku: '09-03', name: 'TESY', price: 133.03, qualifyingPoints: 37.25, commissionPoints: 33.26 },
                { sku: '2-02', name: 'RIM PLUS', price: 133.03, qualifyingPoints: 37.25, commissionPoints: 33.26 },
                { sku: '06-02', name: 'DEBET', price: 133.03, qualifyingPoints: 37.25, commissionPoints: 33.26 }
            ],
            usa: [
                { sku: '01-02', name: 'DIFEST-1', price: 23.69, qualifyingPoints: 39.48, commissionPoints: 39.48 },
                { sku: '1A', name: 'GATILOE-10', price: 25.79, qualifyingPoints: 42.98, commissionPoints: 42.98 },
                { sku: '11-03', name: 'HIPEN-11', price: 15.49, qualifyingPoints: 25.82, commissionPoints: 25.82 },
                { sku: '13-02', name: 'DONDX-13', price: 15.49, qualifyingPoints: 25.82, commissionPoints: 25.82 }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('[v0] DOM loaded, initializing...');
            initializeEventListeners();
            showStep(1);
        });

        function initializeEventListeners() {
            console.log('[v0] Setting up event listeners...');
            
            // Selecci√≥n de pa√≠s
            document.querySelectorAll('.country-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectCountry(this.dataset.country, this.dataset.currency, this.dataset.symbol);
                });
            });

            // Botones de navegaci√≥n
            document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep2').addEventListener('click', () => goToStep(3));
            document.getElementById('nextStep3').addEventListener('click', () => goToStep(4));
            document.getElementById('nextStep4').addEventListener('click', () => goToStep(5));

            document.getElementById('backStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('backStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('backStep4').addEventListener('click', () => goToStep(3));
            document.getElementById('backStep5').addEventListener('click', () => goToStep(4));

            // B√∫squedas
            document.getElementById('warehouseSearch').addEventListener('input', searchWarehouse);
            document.getElementById('distributorSearch').addEventListener('input', searchDistributor);
            document.getElementById('productSearch').addEventListener('input', searchProducts);

            // M√©todo de pago y env√≠o
            document.getElementById('paymentMethod').addEventListener('change', updateSubmitButton);
            document.getElementById('submitOrder').addEventListener('click', submitOrder);
        }

        function selectCountry(country, currency, symbol) {
            console.log('[v0] Country selected:', country);
            
            // Remover selecci√≥n anterior
            document.querySelectorAll('.country-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Seleccionar nuevo pa√≠s
            document.querySelector(`[data-country="${country}"]`).classList.add('selected');
            
            selectedCountry = country;
            selectedCurrency = currency;
            selectedSymbol = symbol;
            
            // Habilitar bot√≥n siguiente
            document.getElementById('nextStep1').disabled = false;
        }

        function goToStep(step) {
            console.log('[v0] goToStep called with step:', step);
            
            // Validar paso actual antes de continuar
            if (!validateCurrentStep()) {
                return;
            }

            // Ocultar todos los pasos
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Mostrar paso actual
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // Actualizar barra de progreso
            const progress = (step / 5) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Cargar contenido espec√≠fico del paso
            if (step === 4) {
                loadProducts();
            } else if (step === 5) {
                updateConfirmationSummary();
                updateSubmitButton();
            }
        }

        function validateCurrentStep() {
            console.log('[v0] validateCurrentStep called, currentStep:', currentStep);
            
            if (currentStep === 1) {
                if (!selectedCountry) {
                    alert('Por favor selecciona un pa√≠s antes de continuar.');
                    return false;
                }
                return true;
            }
            
            if (currentStep === 2) {
                const warehouseName = document.getElementById('warehouseName').value;
                const warehouseCity = document.getElementById('warehouseCity').value;
                const warehouseEmail = document.getElementById('warehouseEmail').value;
                const warehousePhone = document.getElementById('warehousePhone').value;
                
                if (!warehouseName || !warehouseCity || !warehouseEmail || !warehousePhone) {
                    alert('Por favor completa todos los campos del almac√©n.');
                    return false;
                }
                return true;
            }
            
            if (currentStep === 3) {
                const distributorId = document.getElementById('distributorId').value;
                const distributorName = document.getElementById('distributorName').value;
                const distributorEmail = document.getElementById('distributorEmail').value;
                const distributorEmailConfirm = document.getElementById('distributorEmailConfirm').value;
                const distributorPhone = document.getElementById('distributorPhone').value;
                const distributorAddress = document.getElementById('distributorAddress').value;
                
                if (!distributorId || !distributorName || !distributorEmail || !distributorEmailConfirm || !distributorPhone || !distributorAddress) {
                    alert('Por favor completa todos los campos del distribuidor.');
                    return false;
                }
                
                if (distributorEmail !== distributorEmailConfirm) {
                    alert('Los correos electr√≥nicos no coinciden.');
                    return false;
                }
                return true;
            }
            
            if (currentStep === 4) {
                if (cart.length === 0) {
                    alert('Por favor selecciona al menos un producto.');
                    return false;
                }
                return true;
            }
            
            return true;
        }

        function searchWarehouse() {
            const query = document.getElementById('warehouseSearch').value.toLowerCase();
            const results = document.getElementById('warehouseSearchResults');
            
            if (query.length < 2) {
                results.style.display = 'none';
                return;
            }
            
            const warehouses = warehouseData[selectedCountry] || [];
            const filtered = warehouses.filter(warehouse => 
                warehouse.name.toLowerCase().includes(query) || 
                warehouse.city.toLowerCase().includes(query)
            );
            
            if (filtered.length > 0) {
                results.innerHTML = filtered.map(warehouse => 
                    `<div class="search-result" onclick="selectWarehouse('${warehouse.id}')">
                        <strong>${warehouse.name}</strong><br>
                        ${warehouse.city} | ${warehouse.email} | ${warehouse.phone}
                    </div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        }

        function selectWarehouse(warehouseId) {
            const warehouses = warehouseData[selectedCountry] || [];
            const warehouse = warehouses.find(w => w.id === warehouseId);
            
            if (warehouse) {
                document.getElementById('warehouseName').value = warehouse.name;
                document.getElementById('warehouseCity').value = warehouse.city;
                document.getElementById('warehouseEmail').value = warehouse.email;
                document.getElementById('warehousePhone').value = warehouse.phone;
                document.getElementById('warehouseSearchResults').style.display = 'none';
            }
        }

        function searchDistributor() {
            const query = document.getElementById('distributorSearch').value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (query.length < 2) {
                results.style.display = 'none';
                return;
            }
            
            const distributors = sampleDistributors[selectedCountry] || [];
            const filtered = distributors.filter(distributor => 
                distributor.id.toLowerCase().includes(query) ||
                distributor.name.toLowerCase().includes(query) ||
                distributor.email.toLowerCase().includes(query) ||
                distributor.phone.includes(query)
            );
            
            if (filtered.length > 0) {
                results.innerHTML = filtered.map(distributor => 
                    `<div class="search-result" onclick="selectDistributor('${distributor.id}')">
                        <strong>${distributor.id} - ${distributor.name}</strong><br>
                        ${distributor.email} | ${distributor.phone}
                    </div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        }

        function selectDistributor(distributorId) {
            const distributors = sampleDistributors[selectedCountry] || [];
            const distributor = distributors.find(d => d.id === distributorId);
            
            if (distributor) {
                document.getElementById('distributorId').value = distributor.id;
                document.getElementById('distributorName').value = distributor.name;
                document.getElementById('distributorEmail').value = distributor.email;
                document.getElementById('distributorEmailConfirm').value = distributor.email;
                document.getElementById('distributorPhone').value = distributor.phone;
                document.getElementById('distributorAddress').value = distributor.address;
                document.getElementById('searchResults').style.display = 'none';
            }
        }

        function loadProducts() {
            const products = productData[selectedCountry] || [];
            const productList = document.getElementById('productList');
            
            productList.innerHTML = products.map(product => 
                `<div class="product-card">
                    <div class="product-name">${product.name}</div>
                    <div class="product-sku">SKU: ${product.sku}</div>
                    <div class="product-price">${selectedSymbol}${product.price.toFixed(2)} (SIN IVA)</div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateQuantity('${product.sku}', -1)">-</button>
                        <input type="number" class="quantity-input" id="qty-${product.sku}" value="0" min="0" onchange="updateQuantity('${product.sku}', 0)">
                        <button class="quantity-btn" onclick="updateQuantity('${product.sku}', 1)">+</button>
                    </div>
                </div>`
            ).join('');
        }

        function searchProducts() {
            const query = document.getElementById('productSearch').value.toLowerCase();
            const products = productData[selectedCountry] || [];
            
            if (query.length === 0) {
                loadProducts();
                return;
            }
            
            const filtered = products.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.sku.toLowerCase().includes(query)
            );
            
            const productList = document.getElementById('productList');
            productList.innerHTML = filtered.map(product => 
                `<div class="product-card">
                    <div class="product-name">${product.name}</div>
                    <div class="product-sku">SKU: ${product.sku}</div>
                    <div class="product-price">${selectedSymbol}${product.price.toFixed(2)} (SIN IVA)</div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateQuantity('${product.sku}', -1)">-</button>
                        <input type="number" class="quantity-input" id="qty-${product.sku}" value="0" min="0" onchange="updateQuantity('${product.sku}', 0)">
                        <button class="quantity-btn" onclick="updateQuantity('${product.sku}', 1)">+</button>
                    </div>
                </div>`
            ).join('');
        }

        function updateQuantity(sku, change) {
            const input = document.getElementById(`qty-${sku}`);
            let currentValue = parseInt(input.value) || 0;
            
            if (change === 0) {
                currentValue = parseInt(input.value) || 0;
            } else {
                currentValue = Math.max(0, currentValue + change);
            }
            
            input.value = currentValue;
            
            // Actualizar carrito
            const products = productData[selectedCountry] || [];
            const product = products.find(p => p.sku === sku);
            
            if (product) {
                const existingItem = cart.find(item => item.sku === sku);
                
                if (currentValue === 0) {
                    cart = cart.filter(item => item.sku !== sku);
                } else if (existingItem) {
                    existingItem.quantity = currentValue;
                } else {
                    cart.push({
                        sku: product.sku,
                        name: product.name,
                        price: product.price,
                        quantity: currentValue,
                        qualifyingPoints: product.qualifyingPoints,
                        commissionPoints: product.commissionPoints
                    });
                }
            }
        }

        function updateConfirmationSummary() {
            const country = selectedCountry;
            const warehouseName = document.getElementById('warehouseName').value;
            const distributorName = document.getElementById('distributorName').value;
            
            // Configurar m√©todo de pago autom√°tico para Estados Unidos
            const paymentMethodSelect = document.getElementById('paymentMethod');
            if (country === 'usa') {
                paymentMethodSelect.value = 'tarjeta';
                paymentMethodSelect.disabled = true;
            } else {
                paymentMethodSelect.disabled = false;
            }
            
            // Calcular totales
            let subtotal = 0;
            let totalQualifyingPoints = 0;
            let totalCommissionPoints = 0;
            
            cart.forEach(item => {
                subtotal += item.price * item.quantity;
                totalQualifyingPoints += item.qualifyingPoints * item.quantity;
                totalCommissionPoints += item.commissionPoints * item.quantity;
            });
            
            // Calcular IVA seg√∫n pa√≠s
            let taxRate = 0;
            let taxName = '';
            if (country === 'mexico') {
                taxRate = 0.16;
                taxName = 'IVA (16%)';
            } else if (country === 'guatemala') {
                taxRate = 0.12;
                taxName = 'IVA (12%)';
            }
            
            const taxAmount = subtotal * taxRate;
            const total = subtotal + taxAmount;
            
            // Generar resumen
            let summaryHTML = `
                <div class="order-summary-card">
                    <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üè¢ Informaci√≥n del Almac√©n</h3>
                    <p><strong>Almac√©n:</strong> ${warehouseName}</p>
                    <p><strong>Pa√≠s:</strong> ${country.charAt(0).toUpperCase() + country.slice(1)}</p>
                </div>
                
                <div class="order-summary-card">
                    <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üë§ Informaci√≥n del Distribuidor</h3>
                    <p><strong>Distribuidor:</strong> ${distributorName}</p>
                </div>
                
                <div class="order-summary-card">
                    <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üì¶ Productos:</h3>
            `;
            
            cart.forEach(item => {
                summaryHTML += `
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                        <strong>${item.name} (SKU: ${item.sku})</strong><br>
                        Cantidad: ${item.quantity} √ó ${selectedSymbol}${item.price.toFixed(2)} = ${selectedSymbol}${(item.price * item.quantity).toFixed(2)}
                    </div>
                `;
            });
            
            summaryHTML += `
                    <div style="border-top: 2px solid var(--herbax-primary); padding-top: 15px; margin-top: 15px;">
                        <p><strong>Subtotal (SIN IVA): ${selectedSymbol}${subtotal.toFixed(2)}</strong></p>
            `;
            
            if (taxRate > 0) {
                summaryHTML += `
                        <p><strong>${taxName}: ${selectedSymbol}${taxAmount.toFixed(2)}</strong></p>
                        <p style="font-size: 1.2rem; color: var(--herbax-primary);"><strong>Total con IVA: ${selectedSymbol}${total.toFixed(2)}</strong></p>
                `;
            } else {
                summaryHTML += `
                        <p style="font-size: 1.2rem; color: var(--herbax-primary);"><strong>Total: ${selectedSymbol}${subtotal.toFixed(2)} (SIN IVA)</strong></p>
                `;
            }
            
            summaryHTML += `
                        <p><strong>Puntos Calificables:</strong> ${totalQualifyingPoints.toFixed(2)}</p>
                        <p><strong>Puntos Comisionables:</strong> ${totalCommissionPoints.toFixed(2)}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('orderSummary').innerHTML = summaryHTML;
        }

        function updateSubmitButton() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const submitButton = document.getElementById('submitOrder');
            
            if (selectedCountry === 'usa' || paymentMethod) {
                submitButton.disabled = false;
                submitButton.style.background = 'var(--herbax-primary)';
                submitButton.style.cursor = 'pointer';
            } else {
                submitButton.disabled = true;
                submitButton.style.background = '#ccc';
                submitButton.style.cursor = 'not-allowed';
            }
        }

        function submitOrder() {
            console.log('[v0] submitOrder called');
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            if (selectedCountry !== 'usa' && !paymentMethod) {
                alert('Por favor selecciona un m√©todo de pago.');
                return;
            }
            
            // Recopilar todos los datos del pedido
            const orderData = {
                country: selectedCountry,
                currency: selectedCurrency,
                warehouse: {
                    name: document.getElementById('warehouseName').value,
                    city: document.getElementById('warehouseCity').value,
                    email: document.getElementById('warehouseEmail').value,
                    phone: document.getElementById('warehousePhone').value
                },
                distributor: {
                    id: document.getElementById('distributorId').value,
                    name: document.getElementById('distributorName').value,
                    email: document.getElementById('distributorEmail').value,
                    phone: document.getElementById('distributorPhone').value,
                    address: document.getElementById('distributorAddress').value
                },
                products: cart,
                paymentMethod: paymentMethod,
                timestamp: new Date().toISOString()
            };
            
            console.log('[v0] Order data:', orderData);
            
            // Enviar al webhook
            fetch('https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                console.log('[v0] Webhook response:', response);
                if (response.ok) {
                    showConfirmationScreen();
                } else {
                    throw new Error('Error en el env√≠o');
                }
            })
            .catch(error => {
                console.error('[v0] Error:', error);
                alert('Hubo un error al enviar el pedido. Por favor intenta de nuevo.');
            });
        }

        function showConfirmationScreen() {
            // Ocultar formulario y mostrar confirmaci√≥n
            document.querySelectorAll('.step-container').forEach(container => {
                container.style.display = 'none';
            });
            
            // Copiar resumen al screen de confirmaci√≥n
            document.getElementById('finalOrderSummary').innerHTML = document.getElementById('orderSummary').innerHTML;
            
            document.getElementById('confirmationScreen').style.display = 'block';
        }

        function goToHome() {
            // Resetear todo el formulario
            currentStep = 1;
            selectedCountry = null;
            selectedCurrency = 'MXN';
            selectedSymbol = '$';
            cart = [];
            
            // Limpiar formularios
            document.querySelectorAll('input').forEach(input => input.value = '');
            document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            document.querySelectorAll('.country-option').forEach(option => option.classList.remove('selected'));
            
            // Ocultar confirmaci√≥n y mostrar paso 1
            document.getElementById('confirmationScreen').style.display = 'none';
            showStep(1);
            
            // Asegurar que la barra de progreso se resetee
            updateProgressBar();
        }

        function showStep(step) {
            // Ocultar todos los pasos
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Mostrar paso actual
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // Actualizar barra de progreso
            const progress = (step / 5) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function updateProgressBar() {
            const progress = (currentStep / 5) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }
    </script>
</body>
</html>
