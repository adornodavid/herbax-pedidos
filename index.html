<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos Herbax - Portal CADI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --herbax-primary: #3fae29;
            --herbax-secondary: #c4d82e;
            --herbax-dark: #374E5A;
            --herbax-light: #f8fffe;
            --herbax-gray: #9A9791;
            --herbax-success: #3FAE49;
            --herbax-error: #E73233;
            --herbax-warning: #F2CD00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--herbax-primary) 0%, var(--herbax-secondary) 100%);
            min-height: 100vh;
            color: var(--herbax-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header img {
            height: 60px;
            margin-bottom: 15px;
        }

        .header h1 {
            color: var(--herbax-primary);
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            color: var(--herbax-gray);
            font-size: 1.1rem;
        }

        .cadi-info {
            background: var(--herbax-light);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--herbax-primary);
        }

        .cadi-info img {
            height: 40px;
            margin-bottom: 10px;
        }

        .cadi-info p {
            font-size: 0.9rem;
            color: var(--herbax-dark);
        }

        .phone-info {
            background: var(--herbax-primary);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 600;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .step {
            display: flex;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -50%;
            top: 50%;
            width: 100%;
            height: 2px;
            background: #e5e7eb;
            z-index: 1;
        }

        .step.active:not(:last-child)::after,
        .step.completed:not(:last-child)::after {
            background: var(--herbax-primary);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 10px;
            position: relative;
            z-index: 2;
            background: white;
            border: 2px solid #e5e7eb;
            color: var(--herbax-gray);
        }

        .step.active .step-number {
            background: var(--herbax-primary);
            border-color: var(--herbax-primary);
            color: white;
        }

        .step.completed .step-number {
            background: var(--herbax-success);
            border-color: var(--herbax-success);
            color: white;
        }

        .step-text {
            font-weight: 500;
            color: var(--herbax-gray);
        }

        .step.active .step-text {
            color: var(--herbax-primary);
            font-weight: 600;
        }

        .form-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .section-title {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--herbax-primary);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--herbax-light);
        }

        .section-title .icon {
            font-size: 1.8rem;
            margin-right: 15px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            font-weight: 600;
            color: var(--herbax-dark);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .required {
            color: var(--herbax-error);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--herbax-primary);
            box-shadow: 0 0 0 3px rgba(63, 174, 41, 0.1);
        }

        .error {
            border-color: var(--herbax-error) !important;
            box-shadow: 0 0 0 3px rgba(231, 50, 51, 0.1) !important;
        }

        .error-message {
            color: var(--herbax-error);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .country-selector {
            background: var(--herbax-light);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid var(--herbax-primary);
        }

        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .country-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .country-option:hover {
            border-color: var(--herbax-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .country-option.selected {
            border-color: var(--herbax-primary);
            background: rgba(63, 174, 41, 0.05);
        }

        .country-flag {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .country-name {
            font-weight: 600;
            color: var(--herbax-dark);
            margin-bottom: 5px;
        }

        .country-currency {
            font-size: 0.9rem;
            color: var(--herbax-gray);
        }

        .distributor-search {
            position: relative;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--herbax-primary);
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .search-result {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .search-result:hover {
            background: var(--herbax-light);
        }

        .search-result:last-child {
            border-bottom: none;
        }

        .info-card {
            background: var(--herbax-light);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--herbax-primary);
        }

        .info-card h4 {
            color: var(--herbax-primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .payment-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-option:hover {
            border-color: var(--herbax-primary);
        }

        .payment-option.selected {
            border-color: var(--herbax-primary);
            background: rgba(63, 174, 41, 0.05);
        }

        .payment-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--herbax-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #359923;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(63, 174, 41, 0.3);
        }

        .btn-secondary {
            background: var(--herbax-gray);
            color: white;
        }

        .btn-secondary:hover {
            background: #7a7670;
        }

        .btn-full {
            width: 100%;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        .form-actions .btn {
            flex: 1;
        }

        .hidden {
            display: none !important;
        }

        .success-message {
            background: var(--herbax-success);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        .error-alert {
            background: var(--herbax-error);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--herbax-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-container {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .country-grid {
                grid-template-columns: 1fr;
            }

            .payment-methods {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .progress-bar {
                flex-direction: column;
                gap: 10px;
            }

            .step::after {
                display: none;
            }
        }

        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .search-result-item:hover {
            background: var(--herbax-light);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
         Header 
        <div class="header">
            <img src="/images/herbax-logo.png" alt="Herbax Logo">
            <h1>Sistema de Pedidos Herbax</h1>
            <p>Portal Exclusivo para Distribuidores</p>
            
            <div class="cadi-info">
                <img src="/images/cadi-logo.png" alt="CADI Logo">
                <p><strong>Centro de Atenci√≥n a Distribuidores Independientes</strong></p>
                <div class="phone-info">
                    üìû Soporte M√©xico: 800 649 0653
                </div>
            </div>
        </div>

         Progress Bar 
        <div class="progress-bar">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-text">Informaci√≥n Personal</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-text">Direcci√≥n de Env√≠o</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-text">Selecci√≥n de Productos</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-text">Confirmaci√≥n</div>
            </div>
        </div>

         Form Container 
        <div class="form-container">
            <form id="orderForm">
                 Step 1: Personal Information 
                <div class="form-section active" data-section="1">
                    <h2 class="section-title">
                        <span class="icon">üåç</span>
                        Centro de Distribuci√≥n e Informaci√≥n Personal
                    </h2>

                     Country/Distribution Center Selection 
                    <div class="country-selector">
                        <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">
                            Selecciona tu Centro de Distribuci√≥n
                        </h3>
                        <p style="color: var(--herbax-gray); margin-bottom: 15px;">
                            Esto determinar√° los productos disponibles y la moneda de tu pedido
                        </p>
                        
                        <div class="country-grid">
                            <div class="country-option" data-country="mexico" data-currency="MXN" data-symbol="$">
                                <div class="country-flag">üá≤üáΩ</div>
                                <div class="country-name">M√©xico</div>
                                <div class="country-currency">Pesos Mexicanos (MXN)</div>
                            </div>
                            <div class="country-option" data-country="guatemala" data-currency="GTQ" data-symbol="Q">
                                <div class="country-flag">üá¨üáπ</div>
                                <div class="country-name">Guatemala</div>
                                <div class="country-currency">Quetzales (GTQ)</div>
                            </div>
                            <div class="country-option" data-country="usa" data-currency="USD" data-symbol="$">
                                <div class="country-flag">üá∫üá∏</div>
                                <div class="country-name">Estados Unidos</div>
                                <div class="country-currency">D√≥lares (USD)</div>
                            </div>
                        </div>
                        <input type="hidden" id="selectedCountry" name="distributionCenter" required>
                        <input type="hidden" id="selectedCurrency" name="currency">
                        <input type="hidden" id="selectedSymbol" name="currencySymbol">
                    </div>

                     Distributor Information 
                    <div class="info-card">
                        <h4>üìã Informaci√≥n del Distribuidor (Cliente)</h4>
                        <p>Ingresa los datos del distribuidor que realizar√° la compra</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="distributorId">ID de Distribuidor <span class="required">*</span></label>
                            <div class="distributor-search">
                                <input type="text" id="distributorId" name="distributorId" required 
                                       placeholder="Buscar por ID o nombre del distribuidor">
                                <div class="search-results" id="searchResults"></div>
                            </div>
                            <div class="error-message">Este campo es obligatorio</div>
                        </div>
                        <div class="form-group">
                            <label for="distributorName">Nombre Completo del Distribuidor <span class="required">*</span></label>
                            <input type="text" id="distributorName" name="distributorName" required 
                                   placeholder="Nombre completo del distribuidor">
                            <div class="error-message">Por favor ingrese el nombre completo</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="distributorEmail">Correo Electr√≥nico del Distribuidor <span class="required">*</span></label>
                            <input type="email" id="distributorEmail" name="distributorEmail" required 
                                   placeholder="correo@distribuidor.com">
                            <div class="error-message">Ingrese un correo v√°lido</div>
                        </div>
                        <div class="form-group">
                            <label for="distributorPhone">Tel√©fono del Distribuidor <span class="required">*</span></label>
                            <input type="tel" id="distributorPhone" name="distributorPhone" required 
                                   placeholder="10 d√≠gitos (acepta +52, guiones y espacios)">
                            <div class="error-message">Ingresa al menos 10 d√≠gitos</div>
                        </div>
                    </div>

                     Warehouse/Distribution Center Information 
                    <div class="info-card">
                        <h4>üè¢ Informaci√≥n del Centro de Distribuci√≥n (Almac√©n)</h4>
                        <p>Datos del almac√©n donde se procesar√° el pedido</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="warehouseName">Nombre del Centro de Distribuci√≥n <span class="required">*</span></label>
                            <input type="text" id="warehouseName" name="warehouseName" required readonly
                                   placeholder="Se completar√° autom√°ticamente">
                        </div>
                        <div class="form-group">
                            <label for="warehouseEmail">Correo del Centro de Distribuci√≥n <span class="required">*</span></label>
                            <input type="email" id="warehouseEmail" name="warehouseEmail" required readonly
                                   placeholder="Se completar√° autom√°ticamente">
                        </div>
                    </div>

                     Payment Method 
                    <div class="info-card">
                        <h4>üí≥ M√©todo de Pago</h4>
                        <p>Selecciona c√≥mo realizar√°s el pago de tu pedido</p>
                        
                        <div class="payment-methods">
                            <div class="payment-option" data-payment="referencia">
                                <div class="payment-icon">üè¶</div>
                                <div><strong>Referencia Bancaria</strong></div>
                                <div style="font-size: 0.9rem; color: var(--herbax-gray);">Pago por transferencia</div>
                            </div>
                            <div class="payment-option" data-payment="deposito">
                                <div class="payment-icon">üí∞</div>
                                <div><strong>Dep√≥sito</strong></div>
                                <div style="font-size: 0.9rem; color: var(--herbax-gray);">Dep√≥sito en efectivo</div>
                            </div>
                        </div>
                        <input type="hidden" id="paymentMethod" name="paymentMethod" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-primary btn-full" onclick="nextStep()">
                            Continuar ‚Üí
                        </button>
                    </div>
                </div>

                 Step 2: Shipping Address 
                <div class="form-section" data-section="2">
                    <h2 class="section-title">
                        <span class="icon">üì¶</span>
                        Direcci√≥n de Env√≠o
                    </h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="postalCode">C√≥digo Postal <span class="required">*</span></label>
                            <input type="text" id="postalCode" name="postalCode" required 
                                   placeholder="5 d√≠gitos" maxlength="5">
                            <div class="error-message">Ingrese 5 d√≠gitos</div>
                        </div>
                        <div class="form-group">
                            <label for="state">Estado <span class="required">*</span></label>
                            <input type="text" id="state" name="state" required 
                                   placeholder="Estado">
                            <div class="error-message">Campo obligatorio</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="municipality">Municipio/Alcald√≠a <span class="required">*</span></label>
                            <input type="text" id="municipality" name="municipality" required 
                                   placeholder="Municipio o Alcald√≠a">
                            <div class="error-message">Campo obligatorio</div>
                        </div>
                        <div class="form-group">
                            <label for="neighborhood">Colonia/Fracc. <span class="required">*</span></label>
                            <input type="text" id="neighborhood" name="neighborhood" required 
                                   placeholder="Colonia o Fraccionamiento">
                            <div class="error-message">Campo obligatorio</div>
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label for="address">Calle y N√∫mero <span class="required">*</span></label>
                            <input type="text" id="address" name="address" required 
                                   placeholder="Calle, n√∫mero exterior e interior">
                            <div class="error-message">Campo obligatorio</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="recipient">Persona que recibe <span class="required">*</span></label>
                            <input type="text" id="recipient" name="recipient" required 
                                   placeholder="Nombre de quien recibe el pedido">
                            <div class="error-message">Campo obligatorio</div>
                        </div>
                        <div class="form-group">
                            <label for="references">Referencias adicionales</label>
                            <input type="text" id="references" name="references" 
                                   placeholder="Referencias para encontrar la direcci√≥n (opcional)">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            ‚Üê Anterior
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            Continuar ‚Üí
                        </button>
                    </div>
                </div>

                 Step 3: Product Selection 
                <div class="form-section" data-section="3">
                    <h2 class="section-title">
                        <span class="icon">üõí</span>
                        Selecci√≥n de Productos
                    </h2>

                    <div class="info-card">
                        <h4>Productos disponibles para: <span id="selectedCountryDisplay">-</span></h4>
                        <p>Los precios se muestran en <span id="selectedCurrencyDisplay">-</span></p>
                    </div>

                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                        <div>
                            <div style="margin-bottom: 20px;">
                                <input type="text" placeholder="üîç Buscar productos..." 
                                       style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e5e7eb;">
                            </div>
                            
                            <div id="productList">
                                <p style="text-align: center; color: var(--herbax-gray); padding: 40px;">
                                    Selecciona un centro de distribuci√≥n para ver los productos disponibles
                                </p>
                            </div>
                        </div>

                        <div>
                            <div style="background: var(--herbax-light); padding: 20px; border-radius: 15px; position: sticky; top: 20px;">
                                <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üì¶ Tu Pedido</h3>
                                <div id="cartItems">
                                    <p style="color: var(--herbax-gray); text-align: center;">0 productos</p>
                                    <p style="color: var(--herbax-gray); text-align: center; font-size: 0.9rem;">No hay productos en el carrito</p>
                                </div>
                                
                                <div style="border-top: 2px solid white; margin: 20px 0; padding-top: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span>Subtotal:</span>
                                        <strong id="subtotal">$0.00</strong>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: var(--herbax-gray);">
                                        <span>Costo de env√≠o:</span>
                                        <span id="shipping">$200.00</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: 700; color: var(--herbax-primary);">
                                        <span>TOTAL:</span>
                                        <span id="total">$200.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            ‚Üê Anterior
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            Revisar Pedido ‚Üí
                        </button>
                    </div>
                </div>

                 Step 4: Confirmation 
                <div class="form-section" data-section="4">
                    <h2 class="section-title">
                        <span class="icon">‚úÖ</span>
                        Confirma tu Pedido
                    </h2>

                    <div style="display: grid; gap: 20px;">
                        <div class="info-card">
                            <h4>üë§ Informaci√≥n del Distribuidor</h4>
                            <div id="distributorSummary"></div>
                        </div>

                        <div class="info-card">
                            <h4>üè¢ Centro de Distribuci√≥n</h4>
                            <div id="warehouseSummary"></div>
                        </div>

                        <div class="info-card">
                            <h4>üì¶ Direcci√≥n de Env√≠o</h4>
                            <div id="addressSummary"></div>
                        </div>

                        <div class="info-card">
                            <h4>üõí Productos Seleccionados</h4>
                            <div id="productsSummary"></div>
                        </div>

                        <div class="info-card">
                            <h4>üí∞ Resumen de Costos</h4>
                            <div id="costSummary"></div>
                        </div>

                        <div class="info-card">
                            <h4>üí≥ M√©todo de Pago</h4>
                            <div id="paymentSummary"></div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            ‚Üê Modificar
                        </button>
                        <button type="button" class="btn btn-primary" onclick="submitOrder()">
                            üì§ Confirmar y Enviar Pedido
                        </button>
                    </div>
                </div>
            </form>
        </div>

         Success Message 
        <div class="success-message" id="successMessage">
            ‚úÖ ¬°Pedido enviado exitosamente! Recibir√°s un correo de confirmaci√≥n.
        </div>

         Error Message 
        <div class="error-alert" id="errorMessage">
            ‚ùå Error al procesar el pedido. Por favor intenta nuevamente.
        </div>

         Loading 
        <div class="loading" id="loadingMessage">
            <div class="spinner"></div>
            <h3>Procesando tu pedido...</h3>
            <p>Por favor espera un momento</p>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let selectedCountryData = null;
        let cart = [];
        let distributors = [];
        let warehouses = {};

        const sampleDistributors = [
            // Mexico distributors
            {
                id: "MX001",
                name: "Ana Mar√≠a Rodr√≠guez Hern√°ndez",
                email: "ana.rodriguez@email.com",
                phone: "5551234567",
                country: "mexico",
                address: "Av. Insurgentes Sur 1234, Col. Del Valle",
                city: "Ciudad de M√©xico",
                state: "CDMX",
                postalCode: "03100"
            },
            {
                id: "MX002", 
                name: "Carlos Eduardo Mart√≠nez L√≥pez",
                email: "carlos.martinez@email.com",
                phone: "5559876543",
                country: "mexico",
                address: "Calle Morelos 567, Col. Centro",
                city: "Guadalajara",
                state: "Jalisco",
                postalCode: "44100"
            },
            {
                id: "MX003",
                name: "Mar√≠a del Carmen S√°nchez Torres",
                email: "carmen.sanchez@email.com",
                phone: "8181234567",
                country: "mexico",
                address: "Av. Constituci√≥n 890, Col. Moderna",
                city: "Monterrey",
                state: "Nuevo Le√≥n",
                postalCode: "64720"
            },
            // Guatemala distributors
            {
                id: "GT001",
                name: "Jos√© Antonio Morales P√©rez",
                email: "jose.morales@email.com",
                phone: "50212345678",
                country: "guatemala",
                address: "6a Avenida 12-34, Zona 1",
                city: "Guatemala",
                state: "Guatemala",
                postalCode: "01001"
            },
            {
                id: "GT002",
                name: "Luc√≠a Esperanza Castillo Ruiz",
                email: "lucia.castillo@email.com",
                phone: "50287654321",
                country: "guatemala",
                address: "4a Calle 8-90, Zona 4",
                city: "Quetzaltenango",
                state: "Quetzaltenango",
                postalCode: "09001"
            },
            // USA distributors
            {
                id: "US001",
                name: "Michael Johnson Smith",
                email: "michael.johnson@email.com",
                phone: "3051234567",
                country: "usa",
                address: "1234 SW 8th Street",
                city: "Miami",
                state: "Florida",
                postalCode: "33135"
            },
            {
                id: "US002",
                name: "Isabella Garc√≠a Rodr√≠guez",
                email: "isabella.garcia@email.com",
                phone: "2139876543",
                country: "usa",
                address: "5678 Sunset Blvd",
                city: "Los Angeles",
                state: "California",
                postalCode: "90028"
            }
        ];

        const warehouseData = {
            mexico: {
                name: "Centro de Distribuci√≥n M√©xico",
                email: "mexico@herbax.com",
                phone: "800 649 0653",
                address: "Av. Industrial 123, Parque Industrial",
                city: "Tlalnepantla",
                state: "Estado de M√©xico",
                postalCode: "54030"
            },
            guatemala: {
                name: "Centro de Distribuci√≥n Guatemala",
                email: "guatemala@herbax.com",
                phone: "+502 2234-5678",
                address: "Km 14.5 Carretera a El Salvador",
                city: "Guatemala",
                state: "Guatemala",
                postalCode: "01015"
            },
            usa: {
                name: "Distribution Center USA",
                email: "usa@herbax.com",
                phone: "+1 305-555-0123",
                address: "8901 NW 36th Street",
                city: "Miami",
                state: "Florida",
                postalCode: "33166"
            }
        };

        const productData = {
            mexico: [
                {
                    sku: "HBX-MX-001",
                    name: "Herbax Inmune Plus",
                    category: "Sistema Inmunol√≥gico",
                    price: 450,
                    presentation: "60 c√°psulas",
                    description: "Fortalece tu sistema inmunol√≥gico naturalmente"
                },
                {
                    sku: "HBX-MX-002",
                    name: "Herbax Articular Pro",
                    category: "Sistema Articular",
                    price: 520,
                    presentation: "90 c√°psulas",
                    description: "Soporte para articulaciones y movilidad"
                },
                {
                    sku: "HBX-MX-003",
                    name: "Herbax Detox Natural",
                    category: "Desintoxicaci√≥n",
                    price: 380,
                    presentation: "30 sobres",
                    description: "Limpieza y desintoxicaci√≥n del organismo"
                },
                {
                    sku: "HBX-MX-004",
                    name: "Herbax Cardio Vital",
                    category: "Sistema Circulatorio",
                    price: 590,
                    presentation: "60 c√°psulas",
                    description: "Apoyo para la salud cardiovascular"
                },
                {
                    sku: "HBX-MX-005",
                    name: "Herbax Neuro Focus",
                    category: "Sistema Nervioso",
                    price: 480,
                    presentation: "45 c√°psulas",
                    description: "Mejora la concentraci√≥n y memoria"
                },
                {
                    sku: "HBX-MX-006",
                    name: "Herbax Digestivo Plus",
                    category: "Sistema Digestivo",
                    price: 420,
                    presentation: "60 c√°psulas",
                    description: "Mejora la digesti√≥n y salud intestinal"
                },
                {
                    sku: "HBX-MX-007",
                    name: "Herbax Energ√≠a Natural",
                    category: "Nutrici√≥n General",
                    price: 350,
                    presentation: "30 sobres",
                    description: "Aumenta tu energ√≠a de forma natural"
                },
                {
                    sku: "HBX-MX-008",
                    name: "Herbax Mujer Vital",
                    category: "Sistema Reproductivo Fem",
                    price: 480,
                    presentation: "60 c√°psulas",
                    description: "Apoyo integral para la salud femenina"
                }
            ],
            guatemala: [
                {
                    sku: "HBX-GT-001",
                    name: "Herbax Inmune Plus",
                    category: "Sistema Inmunol√≥gico",
                    price: 120,
                    presentation: "60 c√°psulas",
                    description: "Fortalece tu sistema inmunol√≥gico naturalmente"
                },
                {
                    sku: "HBX-GT-002",
                    name: "Herbax Articular Pro",
                    category: "Sistema Articular",
                    price: 140,
                    presentation: "90 c√°psulas",
                    description: "Soporte para articulaciones y movilidad"
                },
                {
                    sku: "HBX-GT-003",
                    name: "Herbax Detox Natural",
                    category: "Desintoxicaci√≥n",
                    price: 95,
                    presentation: "30 sobres",
                    description: "Limpieza y desintoxicaci√≥n del organismo"
                },
                {
                    sku: "HBX-GT-004",
                    name: "Herbax Cardio Vital",
                    category: "Sistema Circulatorio",
                    price: 150,
                    presentation: "60 c√°psulas",
                    description: "Apoyo para la salud cardiovascular"
                },
                {
                    sku: "HBX-GT-005",
                    name: "Herbax Neuro Focus",
                    category: "Sistema Nervioso",
                    price: 125,
                    presentation: "45 c√°psulas",
                    description: "Mejora la concentraci√≥n y memoria"
                },
                {
                    sku: "HBX-GT-006",
                    name: "Herbax Digestivo Plus",
                    category: "Sistema Digestivo",
                    price: 110,
                    presentation: "60 c√°psulas",
                    description: "Mejora la digesti√≥n y salud intestinal"
                }
            ],
            usa: [
                {
                    sku: "HBX-US-001",
                    name: "Herbax Immune Plus",
                    category: "Immune System",
                    price: 25.99,
                    presentation: "60 capsules",
                    description: "Naturally strengthen your immune system"
                },
                {
                    sku: "HBX-US-002",
                    name: "Herbax Joint Pro",
                    category: "Joint System",
                    price: 29.99,
                    presentation: "90 capsules",
                    description: "Support for joints and mobility"
                },
                {
                    sku: "HBX-US-003",
                    name: "Herbax Natural Detox",
                    category: "Detoxification",
                    price: 22.99,
                    presentation: "30 sachets",
                    description: "Body cleansing and detoxification"
                },
                {
                    sku: "HBX-US-004",
                    name: "Herbax Cardio Vital",
                    category: "Circulatory System",
                    price: 34.99,
                    presentation: "60 capsules",
                    description: "Cardiovascular health support"
                },
                {
                    sku: "HBX-US-005",
                    name: "Herbax Neuro Focus",
                    category: "Nervous System",
                    price: 27.99,
                    presentation: "45 capsules",
                    description: "Improve concentration and memory"
                },
                {
                    sku: "HBX-US-006",
                    name: "Herbax Digestive Plus",
                    category: "Digestive System",
                    price: 24.99,
                    presentation: "60 capsules",
                    description: "Improve digestion and gut health"
                },
                {
                    sku: "HBX-US-007",
                    name: "Herbax Natural Energy",
                    category: "General Nutrition",
                    price: 19.99,
                    presentation: "30 sachets",
                    description: "Boost your energy naturally"
                }
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            distributors = sampleDistributors;
            warehouses = warehouseData;
        });

        function setupEventListeners() {
            // Country selection
            document.querySelectorAll('.country-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectCountry(this);
                });
            });

            // Payment method selection
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectPaymentMethod(this);
                });
            });

            // Distributor search
            const distributorInput = document.getElementById('distributorId');
            distributorInput.addEventListener('input', function() {
                searchDistributors(this.value);
            });

            // Form validation
            const inputs = document.querySelectorAll('input[required], select[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
            });
        }

        function selectCountry(element) {
            // Remove previous selection
            document.querySelectorAll('.country-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Add selection to clicked element
            element.classList.add('selected');

            // Store selected country data
            selectedCountryData = {
                country: element.dataset.country,
                currency: element.dataset.currency,
                symbol: element.dataset.symbol
            };

            // Update hidden fields
            document.getElementById('selectedCountry').value = selectedCountryData.country;
            document.getElementById('selectedCurrency').value = selectedCountryData.currency;
            document.getElementById('selectedSymbol').value = selectedCountryData.symbol;

            // Update warehouse information
            updateWarehouseInfo();

            // Update product display
            updateProductDisplay();

            // Update currency displays
            document.getElementById('selectedCountryDisplay').textContent = 
                element.querySelector('.country-name').textContent;
            document.getElementById('selectedCurrencyDisplay').textContent = 
                element.querySelector('.country-currency').textContent;
        }

        function updateWarehouseInfo() {
            if (!selectedCountryData) return;

            const warehouse = warehouses[selectedCountryData.country];
            if (warehouse) {
                document.getElementById('warehouseName').value = warehouse.name;
                document.getElementById('warehouseEmail').value = warehouse.email;
            }
        }

        function updateProductDisplay() {
            if (!selectedCountryData) return;

            const products = productData[selectedCountryData.country] || [];
            const productList = document.getElementById('productList');

            if (products.length === 0) {
                productList.innerHTML = '<p style="text-align: center; color: var(--herbax-gray); padding: 40px;">No hay productos disponibles para este pa√≠s</p>';
                return;
            }

            productList.innerHTML = products.map(product => `
                <div style="background: white; border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 style="color: var(--herbax-primary); margin-bottom: 5px;">${product.name}</h4>
                        <p style="color: var(--herbax-gray); font-size: 0.9rem;">${product.description}</p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--herbax-primary); margin-bottom: 10px;">
                            ${selectedCountryData.symbol}${product.price}
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addToCart('${product.sku}')" style="padding: 8px 16px; font-size: 0.9rem;">
                            Agregar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function selectPaymentMethod(element) {
            // Remove previous selection
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Add selection to clicked element
            element.classList.add('selected');

            // Update hidden field
            document.getElementById('paymentMethod').value = element.dataset.payment;
        }

        function searchDistributors(query) {
            if (!query || query.length < 2) {
                document.getElementById('searchResults').style.display = 'none';
                return;
            }

            const results = sampleDistributors.filter(dist => {
                const searchTerm = query.toLowerCase();
                return (
                    dist.id.toLowerCase().includes(searchTerm) ||
                    dist.name.toLowerCase().includes(searchTerm) ||
                    dist.email.toLowerCase().includes(searchTerm) ||
                    dist.phone.includes(searchTerm.replace(/\D/g, '')) // Remove non-digits for phone search
                );
            });

            const resultsContainer = document.getElementById('searchResults');
            
            if (results.length > 0) {
                resultsContainer.innerHTML = results.map(dist => `
                    <div class="search-result-item" onclick="selectDistributor('${dist.id}')">
                        <div><strong>${dist.id}</strong> - ${dist.name}</div>
                        <div style="font-size: 0.9rem; color: var(--herbax-gray);">
                            üìß ${dist.email} | üì± ${dist.phone}
                        </div>
                    </div>
                `).join('');
                resultsContainer.style.display = 'block';
            } else {
                resultsContainer.innerHTML = '<div class="search-result-item">No se encontraron distribuidores</div>';
                resultsContainer.style.display = 'block';
            }
        }

        function selectDistributor(distributorId) {
            const distributor = sampleDistributors.find(d => d.id === distributorId);
            if (distributor) {
                document.getElementById('distributorId').value = distributor.id;
                document.getElementById('distributorName').value = distributor.name;
                document.getElementById('distributorEmail').value = distributor.email;
                document.getElementById('distributorPhone').value = distributor.phone;
                
                // Auto-fill shipping address if available
                if (distributor.address) {
                    document.getElementById('address').value = distributor.address;
                    document.getElementById('state').value = distributor.state;
                    document.getElementById('postalCode').value = distributor.postalCode;
                }
                
                document.getElementById('searchResults').style.display = 'none';
                
                console.log('[v0] Distributor selected:', distributor);
            }
        }

        function addToCart(productSku) {
            if (!selectedCountryData) return;

            const products = productData[selectedCountryData.country];
            const product = products.find(p => p.sku === productSku);
            if (!product) return;

            // Check if product already in cart
            const existingItem = cart.find(item => item.sku === productSku);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const subtotalEl = document.getElementById('subtotal');
            const totalEl = document.getElementById('total');

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <p style="color: var(--herbax-gray); text-align: center;">0 productos</p>
                    <p style="color: var(--herbax-gray); text-align: center; font-size: 0.9rem;">No hay productos en el carrito</p>
                `;
                subtotalEl.textContent = '$0.00';
                totalEl.textContent = '$200.00';
                return;
            }

            const symbol = selectedCountryData ? selectedCountryData.symbol : '$';
            let subtotal = 0;

            cartItems.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">${item.name}</div>
                            <div style="color: var(--herbax-gray); font-size: 0.8rem;">Cantidad: ${item.quantity}</div>
                        </div>
                        <div style="font-weight: 600; color: var(--herbax-primary);">
                            ${symbol}${itemTotal}
                        </div>
                    </div>
                `;
            }).join('');

            const shipping = 200; // Fixed shipping cost
            const total = subtotal + shipping;

            subtotalEl.textContent = `${symbol}${subtotal}`;
            totalEl.textContent = `${symbol}${total}`;
        }

        function validateField(field) {
            const errorMessage = field.parentNode.querySelector('.error-message');
            let isValid = true;

            // Remove previous error state
            field.classList.remove('error');
            if (errorMessage) {
                errorMessage.classList.remove('show');
            }

            // Check if field is required and empty
            if (field.hasAttribute('required') && !field.value.trim()) {
                isValid = false;
            }

            // Email validation
            if (field.type === 'email' && field.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    isValid = false;
                }
            }

            // Phone validation
            if (field.type === 'tel' && field.value) {
                const phoneRegex = /[\d\s\-\+]{10,}/;
                if (!phoneRegex.test(field.value)) {
                    isValid = false;
                }
            }

            // Postal code validation
            if (field.id === 'postalCode' && field.value) {
                if (field.value.length !== 5 || !/^\d{5}$/.test(field.value)) {
                    isValid = false;
                }
            }

            if (!isValid) {
                field.classList.add('error');
                if (errorMessage) {
                    errorMessage.classList.add('show');
                }
            }

            return isValid;
        }

        function validateStep(step) {
            const section = document.querySelector(`[data-section="${step}"]`);
            const requiredFields = section.querySelectorAll('input[required], select[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });

            // Additional validations for step 1
            if (step === 1) {
                if (!selectedCountryData) {
                    alert('Por favor selecciona un centro de distribuci√≥n');
                    isValid = false;
                }
                if (!document.getElementById('paymentMethod').value) {
                    alert('Por favor selecciona un m√©todo de pago');
                    isValid = false;
                }
            }

            return isValid;
        }

        function nextStep() {
            if (!validateStep(currentStep)) {
                return;
            }

            if (currentStep < 4) {
                // Hide current step
                document.querySelector(`[data-section="${currentStep}"]`).classList.remove('active');
                document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
                document.querySelector(`[data-step="${currentStep}"]`).classList.add('completed');

                // Show next step
                currentStep++;
                document.querySelector(`[data-section="${currentStep}"]`).classList.add('active');
                document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');

                // Update confirmation summary if on step 4
                if (currentStep === 4) {
                    updateConfirmationSummary();
                }

                // Scroll to top
                window.scrollTo(0, 0);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                // Hide current step
                document.querySelector(`[data-section="${currentStep}"]`).classList.remove('active');
                document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');

                // Show previous step
                currentStep--;
                document.querySelector(`[data-section="${currentStep}"]`).classList.add('active');
                document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
                document.querySelector(`[data-step="${currentStep}"]`).classList.remove('completed');

                // Scroll to top
                window.scrollTo(0, 0);
            }
        }

        function updateConfirmationSummary() {
            // Distributor summary
            document.getElementById('distributorSummary').innerHTML = `
                <div style="background: #f8fffe; padding: 15px; border-radius: 8px; border-left: 4px solid var(--herbax-primary);">
                    <p><strong>ID Distribuidor:</strong> ${document.getElementById('distributorId').value}</p>
                    <p><strong>Nombre:</strong> ${document.getElementById('distributorName').value}</p>
                    <p><strong>Email:</strong> ${document.getElementById('distributorEmail').value}</p>
                    <p><strong>Tel√©fono:</strong> ${document.getElementById('distributorPhone').value}</p>
                </div>
            `;

            // Warehouse summary
            document.getElementById('warehouseSummary').innerHTML = `
                <div style="background: #f8fffe; padding: 15px; border-radius: 8px; border-left: 4px solid var(--herbax-secondary);">
                    <p><strong>Centro de Distribuci√≥n:</strong> ${document.getElementById('warehouseName').value}</p>
                    <p><strong>Email Almac√©n:</strong> ${document.getElementById('warehouseEmail').value}</p>
                    <p><strong>Pa√≠s:</strong> ${selectedCountryData ? selectedCountryData.country.toUpperCase() : '-'}</p>
                    <p><strong>Moneda:</strong> ${selectedCountryData ? selectedCountryData.currency : '-'}</p>
                </div>
            `;

            // Address summary
            document.getElementById('addressSummary').innerHTML = `
                <div style="background: #f8fffe; padding: 15px; border-radius: 8px; border-left: 4px solid #549BD4;">
                    <p><strong>C√≥digo Postal:</strong> ${document.getElementById('postalCode').value}</p>
                    <p><strong>Estado:</strong> ${document.getElementById('state').value}</p>
                    <p><strong>Municipio:</strong> ${document.getElementById('municipality').value}</p>
                    <p><strong>Colonia:</strong> ${document.getElementById('neighborhood').value}</p>
                    <p><strong>Direcci√≥n:</strong> ${document.getElementById('address').value}</p>
                    <p><strong>Recibe:</strong> ${document.getElementById('recipient').value}</p>
                    ${document.getElementById('references').value ? `<p><strong>Referencias:</strong> ${document.getElementById('references').value}</p>` : ''}
                </div>
            `;

            // Products summary with SKUs
            if (cart.length > 0) {
                const symbol = selectedCountryData ? selectedCountryData.symbol : '$';
                document.getElementById('productsSummary').innerHTML = `
                    <div style="background: #f8fffe; padding: 15px; border-radius: 8px; border-left: 4px solid #EF7E27;">
                        ${cart.map(item => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--herbax-dark);">${item.name}</div>
                                    <div style="font-size: 0.85rem; color: var(--herbax-gray);">SKU: ${item.sku}</div>
                                    <div style="font-size: 0.85rem; color: var(--herbax-gray);">Cantidad: ${item.quantity}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 600; color: var(--herbax-primary);">${symbol}${(item.price * item.quantity).toFixed(2)}</div>
                                    <div style="font-size: 0.85rem; color: var(--herbax-gray);">${symbol}${item.price.toFixed(2)} c/u</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                document.getElementById('productsSummary').innerHTML = '<p style="text-align: center; color: var(--herbax-gray); padding: 20px;">No hay productos seleccionados</p>';
            }

            const symbol = selectedCountryData ? selectedCountryData.symbol : '$';
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            document.getElementById('costSummary').innerHTML = `
                <div style="background: #f8fffe; padding: 20px; border-radius: 8px; border-left: 4px solid var(--herbax-primary);">
                    <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem; color: var(--herbax-primary);">
                        <span>Total del Pedido:</span>
                        <span>${symbol}${total.toFixed(2)}</span>
                    </div>
                    <div style="font-size: 0.85rem; color: var(--herbax-gray); margin-top: 5px;">
                        *Los costos de env√≠o se calcular√°n por separado
                    </div>
                </div>
            `;

            const paymentMethod = document.getElementById('paymentMethod').value;
            let paymentInfo = '';
            
            if (paymentMethod === 'referencia') {
                paymentInfo = `
                    <div style="background: #f8fffe; padding: 15px; border-radius: 8px; border-left: 4px solid #E73233;">
                        <div style="font-weight: 600; color: var(--herbax-primary); margin-bottom: 10px;">
                            üí≥ Referencia Bancaria - Santander
                        </div>
                        <div style="font-size: 0.9rem; color: var(--herbax-gray);">
                            Se enviar√° la referencia bancaria para realizar el pago
                        </div>
                    </div>
                `;
            } else {
                paymentInfo = `
                    <div style="background: #f8fffe; padding: 15px; border-radius: 8px; border-left: 4px solid #549BD4;">
                        <div style="font-weight: 600; color: var(--herbax-primary); margin-bottom: 10px;">
                            üè¶ Dep√≥sito Bancario - Banregio
                        </div>
                        <div style="font-size: 0.9rem; color: var(--herbax-gray);">
                            Se enviar√° la informaci√≥n para realizar el dep√≥sito bancario
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('paymentSummary').innerHTML = paymentInfo;
        }

        async function submitOrder() {
            // Show loading
            document.getElementById('loadingMessage').style.display = 'block';
            document.querySelector('.form-container').style.display = 'none';

            // Prepare order data
            const orderData = {
                // Distributor information
                distributorId: document.getElementById('distributorId').value,
                distributorName: document.getElementById('distributorName').value,
                distributorEmail: document.getElementById('distributorEmail').value,
                distributorPhone: document.getElementById('distributorPhone').value,
                
                // Warehouse information
                warehouseName: document.getElementById('warehouseName').value,
                warehouseEmail: document.getElementById('warehouseEmail').value,
                distributionCenter: selectedCountryData.country,
                currency: selectedCountryData.currency,
                
                // Shipping address
                postalCode: document.getElementById('postalCode').value,
                state: document.getElementById('state').value,
                municipality: document.getElementById('municipality').value,
                neighborhood: document.getElementById('neighborhood').value,
                address: document.getElementById('address').value,
                recipient: document.getElementById('recipient').value,
                references: document.getElementById('references').value,
                
                // Products and costs
                products: cart,
                subtotal: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                shipping: 200,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) + 200,
                
                // Payment method
                paymentMethod: document.getElementById('paymentMethod').value,
                
                // Timestamp
                orderDate: new Date().toISOString()
            };

            try {
                const webhookUrl = 'https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx';
                
                console.log('[v0] Sending order to webhook:', orderData);
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    // Success
                    console.log('[v0] Order sent successfully');
                    document.getElementById('loadingMessage').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // Reset form after 3 seconds
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                } else {
                    throw new Error('Error en el servidor: ' + response.status);
                }
            } catch (error) {
                console.error('[v0] Error sending order:', error);
                
                // Show error
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
                document.querySelector('.form-container').style.display = 'block';
                
                // Hide error after 5 seconds
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>
