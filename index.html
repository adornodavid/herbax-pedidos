<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos Herbax - Formulario Sencillo</title>
    <style>
        :root {
            --herbax-primary: #3fae29;
            --herbax-secondary: #c4d82e;
            --herbax-dark: #374E5A;
            --herbax-light: #f8fffe;
            --herbax-gray: #6b7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--herbax-light) 0%, #ffffff 100%);
            color: var(--herbax-dark);
            line-height: 1.6;
            font-size: 18px; /* Texto m√°s grande para personas mayores */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        /* Agregando estilos para logo clickeable y pantalla de confirmaci√≥n */
        .logo {
            font-size: 3rem;
            font-weight: bold;
            color: var(--herbax-primary);
            margin-bottom: 10px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        /* Pantalla de confirmaci√≥n */
        .confirmation-screen {
            display: none;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 800px;
        }

        .confirmation-icon {
            font-size: 4rem;
            color: var(--herbax-primary);
            margin-bottom: 20px;
        }

        .confirmation-title {
            font-size: 2rem;
            color: var(--herbax-primary);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .confirmation-message {
            font-size: 1.2rem;
            color: var(--herbax-gray);
            margin-bottom: 30px;
        }

        .order-summary-card {
            background: var(--herbax-light);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .back-to-home-btn {
            background: var(--herbax-primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }

        .back-to-home-btn:hover {
            background: var(--herbax-secondary);
        }

        .subtitle {
            color: var(--herbax-gray);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .support-info {
            background: var(--herbax-light);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--herbax-primary);
        }

        /* Nuevo sistema de pasos secuenciales */
        .step-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .step-container.active {
            display: block;
        }

        .step-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--herbax-light);
        }

        .step-number {
            background: var(--herbax-primary);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .step-title {
            font-size: 1.8rem;
            color: var(--herbax-primary);
            margin-bottom: 10px;
        }

        .step-description {
            color: var(--herbax-gray);
            font-size: 1.1rem;
        }

        /* Selector de pa√≠s m√°s grande y claro */
        .country-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .country-option {
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .country-option:hover {
            border-color: var(--herbax-primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(63, 174, 41, 0.2);
        }

        .country-option.selected {
            border-color: var(--herbax-primary);
            background: rgba(63, 174, 41, 0.05);
        }

        .country-option.selected::after {
            content: "‚úì";
            position: absolute;
            top: 15px;
            right: 20px;
            background: var(--herbax-primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .country-flag {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .country-name {
            font-weight: 600;
            color: var(--herbax-dark);
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .country-currency {
            color: var(--herbax-gray);
            font-size: 1.1rem;
        }

        /* Formularios m√°s grandes y claros */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--herbax-dark);
            font-size: 1.1rem;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--herbax-primary);
            box-shadow: 0 0 0 3px rgba(63, 174, 41, 0.1);
        }

        .search-container {
            position: relative;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--herbax-primary);
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .search-result:hover {
            background: var(--herbax-light);
        }

        .help-text {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 1rem;
        }

        .help-text strong {
            color: #92400e;
        }

        /* Botones m√°s grandes y claros */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: var(--herbax-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2d8a1f;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .button-group {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--herbax-light);
        }

        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--herbax-primary);
            height: 100%;
            transition: width 0.3s ease;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--herbax-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Productos con dise√±o m√°s simple */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .product-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            border-color: var(--herbax-primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-name {
            font-weight: 600;
            color: var(--herbax-dark);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .product-sku {
            color: var(--herbax-gray);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--herbax-primary);
            margin-bottom: 15px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .quantity-btn {
            background: var(--herbax-primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 5px;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .country-grid {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo" onclick="goToHome()">Herbax</div>
            <div class="subtitle">Sistema de Pedidos - Formulario Sencillo</div>
            <div class="support-info">
                <strong>¬øNecesitas ayuda?</strong><br>
                Llama al Centro de Atenci√≥n CADI: <strong>800 649 0653</strong>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 20%"></div>
        </div>

         Paso 1: Selecci√≥n de Pa√≠s 
        <div class="step-container active" id="step1">
            <div class="step-header">
                <div class="step-number">1</div>
                <h2 class="step-title">Selecciona tu Pa√≠s</h2>
                <p class="step-description">
                    Primero necesitamos saber desde qu√© pa√≠s nos est√°s escribiendo.<br>
                    Esto nos ayudar√° a mostrarte los productos y precios correctos.
                </p>
                <p class="text-sm text-gray-600 mt-2"><strong>Sistema exclusivo para Centros de Distribuci√≥n</strong></p>
            </div>

            <div class="country-grid">
                <div class="country-option" data-country="mexico" data-currency="MXN" data-symbol="$">
                    <div class="country-flag">üá≤üáΩ</div>
                    <div class="country-name">M√©xico</div>
                    <div class="country-currency">Precios en Pesos Mexicanos</div>
                </div>
                <div class="country-option" data-country="guatemala" data-currency="GTQ" data-symbol="Q">
                    <div class="country-flag">üá¨üáπ</div>
                    <div class="country-name">Guatemala</div>
                    <div class="country-currency">Precios en Quetzales</div>
                </div>
                <div class="country-option" data-country="usa" data-currency="USD" data-symbol="$">
                    <div class="country-flag">üá∫üá∏</div>
                    <div class="country-name">Estados Unidos</div>
                    <div class="country-currency">Precios en D√≥lares</div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="nextStep1" disabled>
                    Continuar al Paso 2 ‚Üí
                </button>
            </div>
        </div>

         Agregando Paso 2: Selecci√≥n de Almac√©n 
         Paso 2: Selecci√≥n de Almac√©n/Centro de Distribuci√≥n 
        <div class="step-container" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <h2 class="step-title">Selecciona tu Centro de Distribuci√≥n</h2>
                <p class="step-description">
                    Ahora necesitamos saber a qu√© almac√©n o centro de distribuci√≥n perteneces.<br>
                    Puedes buscarlo o llenar los datos manualmente.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar mi Centro de Distribuci√≥n</label>
                <div class="search-container">
                    <input type="text" class="form-input" id="warehouseSearch" 
                           placeholder="Escribe el nombre del almac√©n o ciudad">
                    <div class="search-results" id="warehouseSearchResults"></div>
                </div>
                <div class="help-text">
                    <strong>Ejemplos de b√∫squeda:</strong><br>
                    ‚Ä¢ Por ciudad: "Monterrey", "Ciudad de M√©xico", "Guadalajara"<br>
                    ‚Ä¢ Por nombre: "Almac√©n Central", "Centro Norte"
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre del Almac√©n *</label>
                <input type="text" class="form-input" id="warehouseName" required>
            </div>

            <div class="form-group">
                <label class="form-label">Ciudad *</label>
                <input type="text" class="form-input" id="warehouseCity" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo del Almac√©n *</label>
                <input type="email" class="form-input" id="warehouseEmail" required>
            </div>

            <div class="form-group">
                <label class="form-label">Tel√©fono del Almac√©n *</label>
                <input type="tel" class="form-input" id="warehousePhone" required>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep2">‚Üê Regresar</button>
                <button class="btn btn-primary" id="nextStep2">Continuar al Paso 3 ‚Üí</button>
            </div>
        </div>

         Cambiando Paso 2 a Paso 3: Informaci√≥n del Distribuidor 
         Paso 3: Informaci√≥n del Distribuidor 
        <div class="step-container" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <h2 class="step-title">Informaci√≥n del Distribuidor</h2>
                <p class="step-description">
                    Ahora necesitamos tus datos como distribuidor de Herbax.<br>
                    Si ya eres distribuidor, puedes buscar tu informaci√≥n para que se llene autom√°ticamente.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Buscar mi informaci√≥n de distribuidor</label>
                <div class="search-container">
                    <input type="text" class="form-input" id="distributorSearch" 
                           placeholder="Escribe tu ID de distribuidor, nombre, tel√©fono o correo">
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="help-text">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold text-yellow-800 mb-2">¬øC√≥mo es mi ID de distribuidor?</h4>
                        <div class="text-sm text-yellow-700 space-y-1">
                            <p>‚Ä¢ <strong>M√©xico:</strong> N√∫meros secuenciales (ejemplo: 66, 67, 68...)</p>
                            <p>‚Ä¢ <strong>Guatemala:</strong> Empieza con GT (ejemplo: GT002, GT003...)</p>
                            <p>‚Ä¢ <strong>Estados Unidos:</strong> Empieza con US (ejemplo: US002, US003...)</p>
                            <p class="text-xs mt-2 italic">* Los IDs que empiezan con "P" son solo para pruebas</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ID de Distribuidor *</label>
                <input type="text" class="form-input" id="distributorId" required>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre Completo *</label>
                <input type="text" class="form-input" id="distributorName" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo Electr√≥nico *</label>
                <input type="email" class="form-input" id="distributorEmail" required>
            </div>

            <div class="form-group">
                <label class="form-label">Confirmar Correo Electr√≥nico *</label>
                <input type="email" class="form-input" id="distributorEmailConfirm" required>
            </div>

            <div class="form-group">
                <label class="form-label">Tel√©fono *</label>
                <input type="tel" class="form-input" id="distributorPhone" required>
            </div>

            <div class="form-group">
                <label class="form-label">Direcci√≥n *</label>
                <input type="text" class="form-input" id="distributorAddress" required>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep3">‚Üê Regresar</button>
                <button class="btn btn-primary" id="nextStep3">Continuar al Paso 4 ‚Üí</button>
            </div>
        </div>

         Cambiando Paso 3 a Paso 4: Selecci√≥n de Productos con buscador 
         Paso 4: Selecci√≥n de Productos 
        <div class="step-container" id="step4">
            <div class="step-header">
                <div class="step-number">4</div>
                <h2 class="step-title">Selecciona tus Productos</h2>
                <p class="step-description">
                    Aqu√≠ puedes elegir los productos que deseas ordenar.<br>
                    Los precios mostrados son <strong>SIN impuestos</strong>.
                </p>
            </div>

             Agregando buscador de productos 
            <div class="form-group">
                <label class="form-label">Buscar productos</label>
                <input type="text" class="form-input" id="productSearch" 
                       placeholder="Busca por nombre del producto o SKU (ejemplo: RIM, 26-02, Magnotun)">
                <div class="help-text">
                    <strong>Tip:</strong> Puedes buscar por nombre del producto o por su c√≥digo SKU
                </div>
            </div>

            <div id="productList" class="product-grid">
                 Los productos se cargar√°n aqu√≠ 
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep4">‚Üê Regresar</button>
                <button class="btn btn-primary" id="nextStep4">Ver Resumen del Pedido ‚Üí</button>
            </div>
        </div>

         Cambiando Paso 4 a Paso 5: Confirmaci√≥n 
         Paso 5: Confirmaci√≥n 
        <div class="step-container" id="step5">
            <div class="step-header">
                <div class="step-number">5</div>
                <h2 class="step-title">Confirma tu Pedido</h2>
                <p class="step-description">
                    Revisa que toda la informaci√≥n est√© correcta antes de enviar tu pedido.
                </p>
            </div>

            <div id="orderSummary">
                 El resumen se cargar√° aqu√≠ 
            </div>

            <div class="form-group">
                <label class="form-label">M√©todo de Pago *</label>
                <select class="form-input" id="paymentMethod" required>
                    <option value="">Selecciona un m√©todo de pago</option>
                    <option value="referencia">Referencia Bancaria Santander</option>
                    <option value="deposito">Dep√≥sito Bancario Banregio</option>
                     <!-- Agregando opci√≥n de tarjeta bancaria para Estados Unidos -->
                    <option value="tarjeta">Tarjeta Bancaria</option>
                </select>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="backStep5">‚Üê Regresar</button>
                <button class="btn btn-primary" id="submitOrder">Enviar Pedido</button>
            </div>
        </div>

         Agregando pantalla de confirmaci√≥n despu√©s del env√≠o 
        <div id="confirmationScreen" class="confirmation-screen">
            <div class="confirmation-icon">‚úÖ</div>
            <div class="confirmation-title">¬°Pedido Enviado Exitosamente!</div>
            <div class="confirmation-message">
                Tu pedido ha sido enviado correctamente y ser√° procesado por nuestro equipo.<br>
                Recibir√°s una confirmaci√≥n por correo electr√≥nico en breve.
            </div>
            
            <div class="order-summary-card">
                <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üìã Resumen de tu Pedido</h3>
                <div id="finalOrderSummary"></div>
            </div>

            <button class="back-to-home-btn" onclick="goToHome()">
                üè† Regresar al Inicio
            </button>
        </div>

         Pantalla de carga 
        <div class="loading" id="loadingScreen">
            <div class="spinner"></div>
            <h3>Enviando tu pedido...</h3>
            <p>Por favor espera un momento</p>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx';
        
        let currentStep = 1;
        let selectedCountry = null;
        let selectedCurrency = null;
        let selectedSymbol = null;
        let cart = [];
        let distributorData = {};
        let warehouseData = {}; // Agregando datos de almac√©n

        const sampleWarehouses = {
            mexico: [
                { name: "CADI Monterrey", city: "Monterrey, N.L.", email: "monterrey@herbax.com", phone: "800-649-0653", code: "MTY01" },
                { name: "CADI Ciudad de M√©xico", city: "Ciudad de M√©xico", email: "cdmx@herbax.com", phone: "800-649-0653", code: "CDMX01" },
                { name: "CADI Guadalajara", city: "Guadalajara, Jal.", email: "guadalajara@herbax.com", phone: "800-649-0653", code: "GDL01" },
                { name: "CADI Tijuana", city: "Tijuana, B.C.", email: "tijuana@herbax.com", phone: "800-649-0653", code: "TIJ01" },
                { name: "CADI Puebla", city: "Puebla, Pue.", email: "puebla@herbax.com", phone: "800-649-0653", code: "PUE01" },
                { name: "CADI M√©rida", city: "M√©rida, Yuc.", email: "merida@herbax.com", phone: "800-649-0653", code: "MER01" },
                { name: "CADI Le√≥n", city: "Le√≥n, Gto.", email: "leon@herbax.com", phone: "800-649-0653", code: "LEO01" },
                { name: "CADI Canc√∫n", city: "Canc√∫n, Q.R.", email: "cancun@herbax.com", phone: "800-649-0653", code: "CUN01" }
            ],
            guatemala: [
                { name: "Centro Herbax Guatemala", city: "Ciudad de Guatemala", email: "guatemala@herbax.com", phone: "+502-2345-6789", code: "GT01" },
                { name: "Herbax Quetzaltenango", city: "Quetzaltenango", email: "quetzal@herbax.com", phone: "+502-2345-6789", code: "GT02" },
                { name: "Herbax Escuintla", city: "Escuintla", email: "escuintla@herbax.com", phone: "+502-2345-6789", code: "GT03" },
                { name: "Herbax Antigua", city: "Antigua Guatemala", email: "antigua@herbax.com", phone: "+502-2345-6789", code: "GT04" }
            ],
            usa: [
                { name: "Herbax Distribution Miami", city: "Miami, FL", email: "miami@herbax.com", phone: "+1-800-HERBAX", code: "MIA01" },
                { name: "Herbax Los Angeles", city: "Los Angeles, CA", email: "losangeles@herbax.com", phone: "+1-800-HERBAX", code: "LAX01" },
                { name: "Herbax Houston", city: "Houston, TX", email: "houston@herbax.com", phone: "+1-800-HERBAX", code: "HOU01" },
                { name: "Herbax New York", city: "New York, NY", email: "newyork@herbax.com", phone: "+1-800-HERBAX", code: "NYC01" },
                { name: "Herbax Chicago", city: "Chicago, IL", email: "chicago@herbax.com", phone: "+1-800-HERBAX", code: "CHI01" }
            ]
        };

        const sampleDistributors = [
            // *** DISTRIBUIDOR DE PRUEBA - SOLO PARA TESTING ***
            {
                id: "PMX001",
                name: "David Adorno (PRUEBA)",
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "mexico",
                address: "Eje Exterior 14, Via Cordillera, Nuevo Le√≥n, 66196",
                isPrueba: true
            },
            {
                id: "PGUA001", 
                name: "David Adorno (PRUEBA)",
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "guatemala",
                address: "Eje Exterior 14, Via Cordillera, Guatemala, 01001",
                isPrueba: true
            },
            {
                id: "PUSA001",
                name: "David Adorno (PRUEBA)", 
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "usa",
                address: "Eje Exterior 14, Via Cordillera, Texas, 66196",
                isPrueba: true
            },
            
            // *** DISTRIBUIDORES REALES DE M√âXICO ***
            {
                id: "66",
                name: "Mar√≠a Elena Gonz√°lez Hern√°ndez",
                email: "maria.gonzalez@herbax.com",
                phone: "5512345678",
                country: "mexico",
                address: "Av. Insurgentes Sur 1234, Col. Del Valle, CDMX, 03100"
            },
            {
                id: "67",
                name: "Carlos Alberto Rodr√≠guez L√≥pez",
                email: "carlos.rodriguez@herbax.com",
                phone: "8187654321",
                country: "mexico",
                address: "Blvd. D√≠az Ordaz 456, Col. Santa Mar√≠a, Monterrey, N.L., 64650"
            },
            {
                id: "68",
                name: "Ana Patricia Morales Jim√©nez",
                email: "ana.morales@herbax.com",
                phone: "3398765432",
                country: "mexico",
                address: "Av. L√≥pez Mateos Sur 789, Col. Providencia, Guadalajara, Jal., 44630"
            },
            {
                id: "69",
                name: "Jos√© Luis Hern√°ndez V√°zquez",
                email: "jose.hernandez@herbax.com",
                phone: "2228765432",
                country: "mexico",
                address: "16 de Septiembre 321, Centro, Puebla, Pue., 72000"
            },
            {
                id: "70",
                name: "Laura Beatriz S√°nchez Ruiz",
                email: "laura.sanchez@herbax.com",
                phone: "9999876543",
                country: "mexico",
                address: "Calle 60 No. 456, Centro, M√©rida, Yuc., 97000"
            },
            {
                id: "71",
                name: "Roberto Carlos Mendoza Torres",
                email: "roberto.mendoza@herbax.com",
                phone: "6641234567",
                country: "mexico",
                address: "Av. Revoluci√≥n 789, Zona Centro, Tijuana, B.C., 22000"
            },
            {
                id: "72",
                name: "Claudia Alejandra Ram√≠rez Flores",
                email: "claudia.ramirez@herbax.com",
                phone: "4771234567",
                country: "mexico",
                address: "Blvd. L√≥pez Mateos 234, Centro, Le√≥n, Gto., 37000"
            },
            {
                id: "73",
                name: "Fernando Javier Castro Moreno",
                email: "fernando.castro@herbax.com",
                phone: "9981234567",
                country: "mexico",
                address: "Av. Tulum 567, SM 22, Canc√∫n, Q.R., 77500"
            },

            // *** DISTRIBUIDORES REALES DE GUATEMALA ***
            {
                id: "GT002",
                name: "Roberto Antonio M√©ndez Castillo",
                email: "roberto.mendez@herbax.com.gt",
                phone: "50212345678",
                country: "guatemala",
                address: "6a Avenida 12-34, Zona 1, Ciudad de Guatemala"
            },
            {
                id: "GT003",
                name: "Sof√≠a Isabel Herrera Morales",
                email: "sofia.herrera@herbax.com.gt",
                phone: "50287654321",
                country: "guatemala",
                address: "15 Calle 8-45, Zona 10, Ciudad de Guatemala"
            },
            {
                id: "GT004",
                name: "Mario Alejandro L√≥pez P√©rez",
                email: "mario.lopez@herbax.com.gt",
                phone: "50298765432",
                country: "guatemala",
                address: "4a Calle 15-67, Zona 9, Ciudad de Guatemala"
            },
            {
                id: "GT005",
                name: "Carmen Luc√≠a Rodr√≠guez Garc√≠a",
                email: "carmen.rodriguez@herbax.com.gt",
                phone: "50276543210",
                country: "guatemala",
                address: "12 Avenida 23-45, Quetzaltenango"
            },
            {
                id: "GT006",
                name: "Diego Fernando Morales V√°squez",
                email: "diego.morales@herbax.com.gt",
                phone: "50265432109",
                country: "guatemala",
                address: "8a Calle 34-56, Escuintla"
            },

            // *** DISTRIBUIDORES REALES DE USA ***
            {
                id: "US002",
                name: "Michael Anthony Johnson",
                email: "michael.johnson@herbax.com",
                phone: "3051234567",
                country: "usa",
                address: "1234 Ocean Drive, Miami Beach, FL 33139"
            },
            {
                id: "US003",
                name: "Jennifer Marie Martinez",
                email: "jennifer.martinez@herbax.com",
                phone: "2137654321",
                country: "usa",
                address: "5678 Sunset Blvd, Los Angeles, CA 90028"
            },
            {
                id: "US004",
                name: "David Christopher Wilson",
                email: "david.wilson@herbax.com",
                phone: "7138765432",
                country: "usa",
                address: "9012 Main Street, Houston, TX 77002"
            },
            {
                id: "US005",
                name: "Sarah Elizabeth Brown",
                email: "sarah.brown@herbax.com",
                phone: "2129876543",
                country: "usa",
                address: "456 Broadway, New York, NY 10013"
            },
            {
                id: "US006",
                name: "Robert James Davis",
                email: "robert.davis@herbax.com",
                phone: "4157654321",
                country: "usa",
                address: "789 Market Street, San Francisco, CA 94103"
            }
        ];

        const productData = {
            mexico: [
                { sku: "1", name: "Difest", price: 292.24, qualifyingPoints: 42.38, commissionablePoints: 36.53 },
                { sku: "1A", name: "Vitamina C", price: 223.28, qualifyingPoints: 32.38, commissionablePoints: 27.91 },
                { sku: "2-03", name: "Rim Plus", price: 327.59, qualifyingPoints: 47.50, commissionablePoints: 40.95 },
                { sku: "4", name: "Cobex", price: 219.83, qualifyingPoints: 31.88, commissionablePoints: 27.48 },
                { sku: "4A", name: "Igniflex", price: 299.24, qualifyingPoints: 42.38, commissionablePoints: 36.53 },
                { sku: "5D-09", name: "Dexel Plus Keto", price: 464.66, qualifyingPoints: 67.38, commissionablePoints: 58.08 },
                { sku: "5D-11", name: "Dexel Plus", price: 412.93, qualifyingPoints: 59.88, commissionablePoints: 51.62 },
                { sku: "6", name: "Diabet", price: 219.83, qualifyingPoints: 31.88, commissionablePoints: 27.48 },
                { sku: "7", name: "Tesy", price: 223.28, qualifyingPoints: 32.38, commissionablePoints: 27.91 },
                { sku: "8A-01", name: "BrioReal Max", price: 223.69, qualifyingPoints: 32.44, commissionablePoints: 27.96 }
            ],
            guatemala: [
                { sku: "26-02", name: "RIM", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "09-03", name: "TESY", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "25-02", name: "HIVY 89", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "06-02", name: "DIABET", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "10-03", name: "GATILOE", price: 177.67, qualifyingPoints: 49.75, commissionablePoints: 39.72 },
                { sku: "36A-02", name: "CILCO-LIFE", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 }
            ],
            usa: [
                { sku: "01-02", name: "DIFEST-1", price: 23.69, qualifyingPoints: 39.48, commissionablePoints: 39.48 },
                { sku: "1A", name: "GATILOE-10", price: 25.79, qualifyingPoints: 42.98, commissionablePoints: 42.98 },
                { sku: "11-03", name: "HIPEN-11", price: 15.49, qualifyingPoints: 25.82, commissionablePoints: 25.82 },
                { sku: "13-02", name: "DONDX-13", price: 15.49, qualifyingPoints: 25.82, commissionablePoints: 25.82 },
                { sku: "131A-01", name: "Magnotun 7s Box with 30 envelopes 7g ea.", price: 50.49, qualifyingPoints: 84.15, commissionablePoints: 84.15 }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log("[v0] DOM loaded, initializing application");
    
            // Inicializar la aplicaci√≥n
            showStep(1);
    
            // Selecci√≥n de pa√≠s
            document.querySelectorAll('.country-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectCountry(this);
                });
            });

            // Botones de navegaci√≥n
            document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep2').addEventListener('click', () => goToStep(3));
            document.getElementById('nextStep3').addEventListener('click', () => goToStep(4));
            document.getElementById('nextStep4').addEventListener('click', () => goToStep(5));
    
            document.getElementById('backStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('backStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('backStep4').addEventListener('click', () => goToStep(3));
            document.getElementById('backStep5').addEventListener('click', () => goToStep(4));

            // B√∫squeda de almac√©n
            document.getElementById('warehouseSearch').addEventListener('input', searchWarehouse);
    
            // B√∫squeda de distribuidor
            document.getElementById('distributorSearch').addEventListener('input', searchDistributor);
    
            // B√∫squeda de productos
            document.getElementById('productSearch').addEventListener('input', searchProducts);
    
            // Event listener para el bot√≥n de enviar pedido
            const submitButton = document.getElementById('submitOrder');
            if (submitButton) {
                submitButton.addEventListener('click', function() {
                    console.log("[v0] Submit button clicked");
                    submitOrder();
                });
                console.log("[v0] Submit button event listener added");
            } else {
                console.log("[v0] Submit button not found");
            }
    
            // Event listener para el dropdown de m√©todo de pago
            const paymentMethodSelect = document.getElementById('paymentMethod');
            if (paymentMethodSelect) {
                paymentMethodSelect.addEventListener('change', function() {
                    console.log("[v0] Payment method changed:", this.value);
                    updateSubmitButton();
                });
                console.log("[v0] Payment method event listener added");
            } else {
                console.log("[v0] Payment method select not found");
            }
        });

        async function submitOrder() {
            console.log("[v0] submitOrder function called");
    
            const paymentMethod = document.getElementById('paymentMethod').value;
            console.log("[v0] Payment method:", paymentMethod);
    
            if (!paymentMethod) {
                alert('Por favor selecciona un m√©todo de pago');
                return;
            }

            try {
                console.log("[v0] Preparing order data");
        
                // Recopilar datos del pedido
                const orderData = {
                    // Datos del pa√≠s
                    country: selectedCountry,
                    currency: selectedCurrency,
            
                    // Datos del almac√©n
                    warehouse: {
                        name: document.getElementById('warehouseName').value,
                        city: document.getElementById('warehouseCity').value,
                        email: document.getElementById('warehouseEmail').value,
                        phone: document.getElementById('warehousePhone').value
                    },
            
                    // Datos del distribuidor
                    distributor: {
                        id: document.getElementById('distributorId').value,
                        name: document.getElementById('distributorName').value,
                        email: document.getElementById('distributorEmail').value,
                        phone: document.getElementById('distributorPhone').value,
                        address: document.getElementById('distributorAddress').value
                    },
            
                    // Productos
                    products: cart,
            
                    // Totales
                    subtotal: calculateSubtotal(),
                    tax: calculateTax(),
                    total: calculateTotal(),
            
                    // Puntos
                    qualifyingPoints: calculateQualifyingPoints(),
                    commissionPoints: calculateCommissionPoints(),
            
                    // M√©todo de pago
                    paymentMethod: paymentMethod,
            
                    // Timestamp
                    timestamp: new Date().toISOString()
                };

                console.log("[v0] Order data prepared:", orderData);

                // Enviar al webhook
                const response = await fetch('https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                console.log("[v0] Webhook response status:", response.status);

                if (response.ok) {
                    console.log("[v0] Order sent successfully");
                    showConfirmationScreen(orderData);
                } else {
                    console.error("[v0] Error sending order:", response.statusText);
                    alert('Error al enviar el pedido. Por favor intenta de nuevo.');
                }
            } catch (error) {
                console.error("[v0] Error in submitOrder:", error);
                alert('Error al enviar el pedido. Por favor intenta de nuevo.');
            }
        }

        function updateSubmitButton() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const submitButton = document.getElementById('submitOrder');
    
            if (submitButton) {
                if (paymentMethod) {
                    submitButton.disabled = false;
                    submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    console.log("[v0] Submit button enabled");
                } else {
                    submitButton.disabled = true;
                    submitButton.classList.add('opacity-50', 'cursor-not-allowed');
                    console.log("[v0] Submit button disabled");
                }
            }
        }

        const sampleWarehouses = {
            mexico: [
                { name: "CADI Monterrey", city: "Monterrey, N.L.", email: "monterrey@herbax.com", phone: "800-649-0653", code: "MTY01" },
                { name: "CADI Ciudad de M√©xico", city: "Ciudad de M√©xico", email: "cdmx@herbax.com", phone: "800-649-0653", code: "CDMX01" },
                { name: "CADI Guadalajara", city: "Guadalajara, Jal.", email: "guadalajara@herbax.com", phone: "800-649-0653", code: "GDL01" },
                { name: "CADI Tijuana", city: "Tijuana, B.C.", email: "tijuana@herbax.com", phone: "800-649-0653", code: "TIJ01" },
                { name: "CADI Puebla", city: "Puebla, Pue.", email: "puebla@herbax.com", phone: "800-649-0653", code: "PUE01" },
                { name: "CADI M√©rida", city: "M√©rida, Yuc.", email: "merida@herbax.com", phone: "800-649-0653", code: "MER01" },
                { name: "CADI Le√≥n", city: "Le√≥n, Gto.", email: "leon@herbax.com", phone: "800-649-0653", code: "LEO01" },
                { name: "CADI Canc√∫n", city: "Canc√∫n, Q.R.", email: "cancun@herbax.com", phone: "800-649-0653", code: "CUN01" }
            ],
            guatemala: [
                { name: "Centro Herbax Guatemala", city: "Ciudad de Guatemala", email: "guatemala@herbax.com", phone: "+502-2345-6789", code: "GT01" },
                { name: "Herbax Quetzaltenango", city: "Quetzaltenango", email: "quetzal@herbax.com", phone: "+502-2345-6789", code: "GT02" },
                { name: "Herbax Escuintla", city: "Escuintla", email: "escuintla@herbax.com", phone: "+502-2345-6789", code: "GT03" },
                { name: "Herbax Antigua", city: "Antigua Guatemala", email: "antigua@herbax.com", phone: "+502-2345-6789", code: "GT04" }
            ],
            usa: [
                { name: "Herbax Distribution Miami", city: "Miami, FL", email: "miami@herbax.com", phone: "+1-800-HERBAX", code: "MIA01" },
                { name: "Herbax Los Angeles", city: "Los Angeles, CA", email: "losangeles@herbax.com", phone: "+1-800-HERBAX", code: "LAX01" },
                { name: "Herbax Houston", city: "Houston, TX", email: "houston@herbax.com", phone: "+1-800-HERBAX", code: "HOU01" },
                { name: "Herbax New York", city: "New York, NY", email: "newyork@herbax.com", phone: "+1-800-HERBAX", code: "NYC01" },
                { name: "Herbax Chicago", city: "Chicago, IL", email: "chicago@herbax.com", phone: "+1-800-HERBAX", code: "CHI01" }
            ]
        };

        const sampleDistributors = [
            // *** DISTRIBUIDOR DE PRUEBA - SOLO PARA TESTING ***
            {
                id: "PMX001",
                name: "David Adorno (PRUEBA)",
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "mexico",
                address: "Eje Exterior 14, Via Cordillera, Nuevo Le√≥n, 66196",
                isPrueba: true
            },
            {
                id: "PGUA001", 
                name: "David Adorno (PRUEBA)",
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "guatemala",
                address: "Eje Exterior 14, Via Cordillera, Guatemala, 01001",
                isPrueba: true
            },
            {
                id: "PUSA001",
                name: "David Adorno (PRUEBA)", 
                email: "adorno.david@gmail.com",
                phone: "8110669931",
                country: "usa",
                address: "Eje Exterior 14, Via Cordillera, Texas, 66196",
                isPrueba: true
            },
            
            // *** DISTRIBUIDORES REALES DE M√âXICO ***
            {
                id: "66",
                name: "Mar√≠a Elena Gonz√°lez Hern√°ndez",
                email: "maria.gonzalez@herbax.com",
                phone: "5512345678",
                country: "mexico",
                address: "Av. Insurgentes Sur 1234, Col. Del Valle, CDMX, 03100"
            },
            {
                id: "67",
                name: "Carlos Alberto Rodr√≠guez L√≥pez",
                email: "carlos.rodriguez@herbax.com",
                phone: "8187654321",
                country: "mexico",
                address: "Blvd. D√≠az Ordaz 456, Col. Santa Mar√≠a, Monterrey, N.L., 64650"
            },
            {
                id: "68",
                name: "Ana Patricia Morales Jim√©nez",
                email: "ana.morales@herbax.com",
                phone: "3398765432",
                country: "mexico",
                address: "Av. L√≥pez Mateos Sur 789, Col. Providencia, Guadalajara, Jal., 44630"
            },
            {
                id: "69",
                name: "Jos√© Luis Hern√°ndez V√°zquez",
                email: "jose.hernandez@herbax.com",
                phone: "2228765432",
                country: "mexico",
                address: "16 de Septiembre 321, Centro, Puebla, Pue., 72000"
            },
            {
                id: "70",
                name: "Laura Beatriz S√°nchez Ruiz",
                email: "laura.sanchez@herbax.com",
                phone: "9999876543",
                country: "mexico",
                address: "Calle 60 No. 456, Centro, M√©rida, Yuc., 97000"
            },
            {
                id: "71",
                name: "Roberto Carlos Mendoza Torres",
                email: "roberto.mendoza@herbax.com",
                phone: "6641234567",
                country: "mexico",
                address: "Av. Revoluci√≥n 789, Zona Centro, Tijuana, B.C., 22000"
            },
            {
                id: "72",
                name: "Claudia Alejandra Ram√≠rez Flores",
                email: "claudia.ramirez@herbax.com",
                phone: "4771234567",
                country: "mexico",
                address: "Blvd. L√≥pez Mateos 234, Centro, Le√≥n, Gto., 37000"
            },
            {
                id: "73",
                name: "Fernando Javier Castro Moreno",
                email: "fernando.castro@herbax.com",
                phone: "9981234567",
                country: "mexico",
                address: "Av. Tulum 567, SM 22, Canc√∫n, Q.R., 77500"
            },

            // *** DISTRIBUIDORES REALES DE GUATEMALA ***
            {
                id: "GT002",
                name: "Roberto Antonio M√©ndez Castillo",
                email: "roberto.mendez@herbax.com.gt",
                phone: "50212345678",
                country: "guatemala",
                address: "6a Avenida 12-34, Zona 1, Ciudad de Guatemala"
            },
            {
                id: "GT003",
                name: "Sof√≠a Isabel Herrera Morales",
                email: "sofia.herrera@herbax.com.gt",
                phone: "50287654321",
                country: "guatemala",
                address: "15 Calle 8-45, Zona 10, Ciudad de Guatemala"
            },
            {
                id: "GT004",
                name: "Mario Alejandro L√≥pez P√©rez",
                email: "mario.lopez@herbax.com.gt",
                phone: "50298765432",
                country: "guatemala",
                address: "4a Calle 15-67, Zona 9, Ciudad de Guatemala"
            },
            {
                id: "GT005",
                name: "Carmen Luc√≠a Rodr√≠guez Garc√≠a",
                email: "carmen.rodriguez@herbax.com.gt",
                phone: "50276543210",
                country: "guatemala",
                address: "12 Avenida 23-45, Quetzaltenango"
            },
            {
                id: "GT006",
                name: "Diego Fernando Morales V√°squez",
                email: "diego.morales@herbax.com.gt",
                phone: "50265432109",
                country: "guatemala",
                address: "8a Calle 34-56, Escuintla"
            },

            // *** DISTRIBUIDORES REALES DE USA ***
            {
                id: "US002",
                name: "Michael Anthony Johnson",
                email: "michael.johnson@herbax.com",
                phone: "3051234567",
                country: "usa",
                address: "1234 Ocean Drive, Miami Beach, FL 33139"
            },
            {
                id: "US003",
                name: "Jennifer Marie Martinez",
                email: "jennifer.martinez@herbax.com",
                phone: "2137654321",
                country: "usa",
                address: "5678 Sunset Blvd, Los Angeles, CA 90028"
            },
            {
                id: "US004",
                name: "David Christopher Wilson",
                email: "david.wilson@herbax.com",
                phone: "7138765432",
                country: "usa",
                address: "9012 Main Street, Houston, TX 77002"
            },
            {
                id: "US005",
                name: "Sarah Elizabeth Brown",
                email: "sarah.brown@herbax.com",
                phone: "2129876543",
                country: "usa",
                address: "456 Broadway, New York, NY 10013"
            },
            {
                id: "US006",
                name: "Robert James Davis",
                email: "robert.davis@herbax.com",
                phone: "4157654321",
                country: "usa",
                address: "789 Market Street, San Francisco, CA 94103"
            }
        ];

        const productData = {
            mexico: [
                { sku: "1", name: "Difest", price: 292.24, qualifyingPoints: 42.38, commissionablePoints: 36.53 },
                { sku: "1A", name: "Vitamina C", price: 223.28, qualifyingPoints: 32.38, commissionablePoints: 27.91 },
                { sku: "2-03", name: "Rim Plus", price: 327.59, qualifyingPoints: 47.50, commissionablePoints: 40.95 },
                { sku: "4", name: "Cobex", price: 219.83, qualifyingPoints: 31.88, commissionablePoints: 27.48 },
                { sku: "4A", name: "Igniflex", price: 299.24, qualifyingPoints: 42.38, commissionablePoints: 36.53 },
                { sku: "5D-09", name: "Dexel Plus Keto", price: 464.66, qualifyingPoints: 67.38, commissionablePoints: 58.08 },
                { sku: "5D-11", name: "Dexel Plus", price: 412.93, qualifyingPoints: 59.88, commissionablePoints: 51.62 },
                { sku: "6", name: "Diabet", price: 219.83, qualifyingPoints: 31.88, commissionablePoints: 27.48 },
                { sku: "7", name: "Tesy", price: 223.28, qualifyingPoints: 32.38, commissionablePoints: 27.91 },
                { sku: "8A-01", name: "BrioReal Max", price: 223.69, qualifyingPoints: 32.44, commissionablePoints: 27.96 }
            ],
            guatemala: [
                { sku: "26-02", name: "RIM", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "09-03", name: "TESY", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "25-02", name: "HIVY 89", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "06-02", name: "DIABET", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 },
                { sku: "10-03", name: "GATILOE", price: 177.67, qualifyingPoints: 49.75, commissionablePoints: 39.72 },
                { sku: "36A-02", name: "CILCO-LIFE", price: 133.03, qualifyingPoints: 37.25, commissionablePoints: 33.26 }
            ],
            usa: [
                { sku: "01-02", name: "DIFEST-1", price: 23.69, qualifyingPoints: 39.48, commissionablePoints: 39.48 },
                { sku: "1A", name: "GATILOE-10", price: 25.79, qualifyingPoints: 42.98, commissionablePoints: 42.98 },
                { sku: "11-03", name: "HIPEN-11", price: 15.49, qualifyingPoints: 25.82, commissionablePoints: 25.82 },
                { sku: "13-02", name: "DONDX-13", price: 15.49, qualifyingPoints: 25.82, commissionablePoints: 25.82 },
                { sku: "131A-01", name: "Magnotun 7s Box with 30 envelopes 7g ea.", price: 50.49, qualifyingPoints: 84.15, commissionablePoints: 84.15 }
            ]
        };

        function calculateSubtotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function calculateTax() {
            let taxRate = 0;
            if (selectedCountry === 'mexico') {
                taxRate = 0.16; // 16% IVA
            } else if (selectedCountry === 'guatemala') {
                taxRate = 0.12; // 12% IVA
            }
            return calculateSubtotal() * taxRate;
        }

        function calculateTotal() {
            return calculateSubtotal() + calculateTax();
        }

        function calculateQualifyingPoints() {
            return cart.reduce((sum, item) => sum + (item.qualifyingPoints * item.quantity), 0);
        }

        function calculateCommissionPoints() {
            return cart.reduce((sum, item) => sum + (item.commissionablePoints * item.quantity), 0);
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
        });

        function initializeEventListeners() {
            // Selecci√≥n de pa√≠s
            document.querySelectorAll('.country-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectCountry(this);
                });
            });

            // Botones de navegaci√≥n
            document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep2').addEventListener('click', () => goToStep(3));
            document.getElementById('nextStep3').addEventListener('click', () => goToStep(4));
            document.getElementById('nextStep4').addEventListener('click', () => goToStep(5));
            
            document.getElementById('backStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('backStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('backStep4').addEventListener('click', () => goToStep(3));
            document.getElementById('backStep5').addEventListener('click', () => goToStep(4));

            // B√∫squeda de almac√©n
            document.getElementById('warehouseSearch').addEventListener('input', searchWarehouse);
            
            // B√∫squeda de distribuidor
            document.getElementById('distributorSearch').addEventListener('input', searchDistributor);
            
            // B√∫squeda de productos
            document.getElementById('productSearch').addEventListener('input', searchProducts);
            
        async function submitOrder() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (!paymentMethod) {
                alert('Por favor selecciona un m√©todo de pago.');
                return;
            }

            if (cart.length === 0) {
                alert('Por favor agrega al menos un producto a tu pedido.');
                return;
            }

            const orderData = {
                timestamp: new Date().toISOString(),
                country: selectedCountry,
                warehouse: selectedWarehouse,
                distributor: selectedDistributor,
                products: cart,
                totals: calculateTotals(),
                paymentMethod: paymentMethod
            };

            try {
                const response = await fetch('https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    showConfirmationScreen(orderData);
                } else {
                    alert('Error al enviar el pedido. Por favor intenta nuevamente.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al enviar el pedido. Por favor intenta nuevamente.');
            }
        }

        function updateSubmitButton() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const submitButton = document.getElementById('submitOrder');
            
            if (paymentMethod) {
                submitButton.disabled = false;
                submitButton.style.opacity = '1';
                submitButton.style.cursor = 'pointer';
            } else {
                submitButton.disabled = true;
                submitButton.style.opacity = '0.5';
                submitButton.style.cursor = 'not-allowed';
            }
        }

            document.getElementById('submitOrder').addEventListener('click', submitOrder);
            document.getElementById('paymentMethod').addEventListener('change', updateSubmitButton);
        }

        function selectCountry(element) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('.country-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Seleccionar nuevo pa√≠s
            element.classList.add('selected');
            
            selectedCountry = element.dataset.country;
            selectedCurrency = element.dataset.currency;
            selectedSymbol = element.dataset.symbol;
            
            console.log("[v0] Country selected:", selectedCountry);
            console.log("[v0] Currency:", selectedCurrency);
            
            // Habilitar bot√≥n siguiente
            document.getElementById('nextStep1').disabled = false;
        }

        function goToStep(step) {
            console.log("[v0] goToStep called with step:", step);
            console.log("[v0] currentStep:", currentStep);
            console.log("[v0] selectedCountry:", selectedCountry);
            
            // Validar paso actual antes de continuar
            if (!validateCurrentStep()) {
                return;
            }

            // Ocultar todos los pasos
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Mostrar paso actual
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // Actualizar barra de progreso
            const progress = (step / 5) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Cargar contenido espec√≠fico del paso
            if (step === 4) {
                loadProducts();
            } else if (step === 5) {
                loadOrderSummary();
            }
        }

        function validateCurrentStep() {
            console.log("[v0] validateCurrentStep called, currentStep:", currentStep);
            console.log("[v0] selectedCountry:", selectedCountry);
            
            if (currentStep === 1) {
                if (selectedCountry === null || selectedCountry === '') {
                    alert('Por favor selecciona un pa√≠s antes de continuar.');
                    return false;
                }
                return true;
            } else if (currentStep === 2) {
                const name = document.getElementById('warehouseName').value;
                const city = document.getElementById('warehouseCity').value;
                const email = document.getElementById('warehouseEmail').value;
                const phone = document.getElementById('warehousePhone').value;
                
                if (!name || !city || !email || !phone) {
                    alert('Por favor completa todos los campos del almac√©n.');
                    return false;
                }
                
                warehouseData = { name, city, email, phone };
                return true;
            } else if (currentStep === 3) {
                const id = document.getElementById('distributorId').value;
                const name = document.getElementById('distributorName').value;
                const email = document.getElementById('distributorEmail').value;
                const emailConfirm = document.getElementById('distributorEmailConfirm').value;
                const phone = document.getElementById('distributorPhone').value;
                const address = document.getElementById('distributorAddress').value;
                
                if (!id || !name || !email || !emailConfirm || !phone || !address) {
                    alert('Por favor completa todos los campos obligatorios.');
                    return false;
                }
                
                if (email !== emailConfirm) {
                    alert('Los correos electr√≥nicos no coinciden.');
                    return false;
                }
                
                distributorData = { id, name, email, phone, address };
                return true;
            } else if (currentStep === 4) {
                if (cart.length === 0) {
                    alert('Por favor selecciona al menos un producto.');
                    return false;
                }
                return true;
            }
            return true;
        }

        function searchWarehouse() {
            const query = this.value.toLowerCase();
            const results = document.getElementById('warehouseSearchResults');
            
            if (query.length < 2) {
                results.style.display = 'none';
                return;
            }
            
            const warehouses = sampleWarehouses[selectedCountry] || [];
            const filteredWarehouses = warehouses.filter(warehouse => 
                warehouse.name.toLowerCase().includes(query) ||
                warehouse.city.toLowerCase().includes(query)
            );
            
            if (filteredWarehouses.length > 0) {
                results.innerHTML = filteredWarehouses.map(warehouse => 
                    `<div class="search-result" onclick="selectWarehouse('${warehouse.name}', '${warehouse.city}', '${warehouse.email}', '${warehouse.phone}')">
                        <strong>${warehouse.name}</strong><br>
                        <small>${warehouse.city} | ${warehouse.email} | ${warehouse.phone}</small>
                    </div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        }

        function selectWarehouse(name, city, email, phone) {
            document.getElementById('warehouseName').value = name;
            document.getElementById('warehouseCity').value = city;
            document.getElementById('warehouseEmail').value = email;
            document.getElementById('warehousePhone').value = phone;
            document.getElementById('warehouseSearchResults').style.display = 'none';
        }

        function searchDistributor() {
            const query = this.value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (query.length < 2) {
                results.style.display = 'none';
                return;
            }
            
            const filteredDistributors = sampleDistributors.filter(dist => 
                dist.country === selectedCountry &&
                (dist.id.toLowerCase().includes(query) ||
                 dist.name.toLowerCase().includes(query) ||
                 dist.email.toLowerCase().includes(query) ||
                 dist.phone.includes(query))
            );
            
            if (filteredDistributors.length > 0) {
                results.innerHTML = filteredDistributors.map(dist => 
                    `<div class="search-result" onclick="selectDistributor('${dist.id}')">
                        <strong>${dist.id}</strong> - ${dist.name}<br>
                        <small>${dist.email} | ${dist.phone}</small>
                    </div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        }

        function selectDistributor(id) {
            const distributor = sampleDistributors.find(d => d.id === id);
            if (distributor) {
                document.getElementById('distributorId').value = distributor.id;
                document.getElementById('distributorName').value = distributor.name;
                document.getElementById('distributorEmail').value = distributor.email;
                document.getElementById('distributorEmailConfirm').value = distributor.email;
                document.getElementById('distributorPhone').value = distributor.phone;
                document.getElementById('distributorAddress').value = distributor.address;
                document.getElementById('searchResults').style.display = 'none';
            }
        }

        function searchProducts() {
            const query = this.value.toLowerCase();
            const products = productData[selectedCountry] || [];
            
            if (query.length === 0) {
                loadProducts(); // Mostrar todos los productos
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(query) ||
                product.sku.toLowerCase().includes(query)
            );
            
            displayProducts(filteredProducts);
        }

        function loadProducts() {
            const products = productData[selectedCountry] || [];
            displayProducts(products);
        }

        function displayProducts(products) {
            const productList = document.getElementById('productList');
            
            if (products.length === 0) {
                productList.innerHTML = '<p style="text-align: center; color: var(--herbax-gray);">No se encontraron productos con esa b√∫squeda.</p>';
                return;
            }
            
            productList.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-name">${product.name}</div>
                    <div class="product-sku">SKU: ${product.sku}</div>
                    <div class="product-price">${selectedSymbol}${product.price.toFixed(2)} <small>(SIN impuestos)</small></div>
                    <div style="font-size: 0.9rem; color: var(--herbax-gray); margin: 5px 0;">
                        Puntos Calificables: ${product.qualifyingPoints} | Comisionables: ${product.commissionablePoints}
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="changeQuantity('${product.sku}', -1)">-</button>
                        <input type="number" class="quantity-input" id="qty-${product.sku}" value="${getCartQuantity(product.sku)}" min="0" 
                               onchange="updateQuantity('${product.sku}', this.value)">
                        <button class="quantity-btn" onclick="changeQuantity('${product.sku}', 1)">+</button>
                    </div>
                </div>
            `).join('');
        }

        function getCartQuantity(sku) {
            const item = cart.find(item => item.sku === sku);
            return item ? item.quantity : 0;
        }

        function changeQuantity(sku, change) {
            const input = document.getElementById(`qty-${sku}`);
            const newValue = Math.max(0, parseInt(input.value) + change);
            input.value = newValue;
            updateQuantity(sku, newValue);
        }

        function updateQuantity(sku, quantity) {
            const product = productData[selectedCountry].find(p => p.sku === sku);
            if (!product) return;
            
            const existingIndex = cart.findIndex(item => item.sku === sku);
            
            if (quantity > 0) {
                if (existingIndex >= 0) {
                    cart[existingIndex].quantity = parseInt(quantity);
                } else {
                    cart.push({
                        sku: product.sku,
                        name: product.name,
                        price: product.price,
                        quantity: parseInt(quantity),
                        qualifyingPoints: product.qualifyingPoints,
                        commissionablePoints: product.commissionablePoints
                    });
                }
            } else {
                if (existingIndex >= 0) {
                    cart.splice(existingIndex, 1);
                }
            }
        }

        function loadOrderSummary() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalQualifyingPoints = cart.reduce((sum, item) => sum + (item.qualifyingPoints * item.quantity), 0);
            const totalCommissionablePoints = cart.reduce((sum, item) => sum + (item.commissionablePoints * item.quantity), 0);
            
            let discountNotice = '';
            if (selectedCountry === 'usa' && total >= 1000) {
                discountNotice = `
                    <div style="background: #d1fae5; border: 2px solid #10b981; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <strong>üéâ ¬°Descuento Aplicado!</strong><br>
                        Tu pedido es mayor a $1,000 USD, por lo que recibes precios especiales con descuento.
                    </div>
                `;
            }
            
            document.getElementById('orderSummary').innerHTML = `
                ${discountNotice}
                
                <div style="background: #f9fafb; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: var(--herbax-primary); margin-bottom: 15px;">üìã Resumen del Pedido</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>Pa√≠s:</strong> ${selectedCountry === 'mexico' ? 'M√©xico' : selectedCountry === 'guatemala' ? 'Guatemala' : 'Estados Unidos'}<br>
                        <strong>Almac√©n:</strong> ${warehouseData.name} - ${warehouseData.city}<br>
                        <strong>Correo Almac√©n:</strong> ${warehouseData.email}<br>
                        <strong>Tel√©fono Almac√©n:</strong> ${warehouseData.phone}<br><br>
                        <strong>Distribuidor:</strong> ${distributorData.name} (${distributorData.id})<br>
                        <strong>Correo Distribuidor:</strong> ${distributorData.email}<br>
                        <strong>Tel√©fono Distribuidor:</strong> ${distributorData.phone}<br>
                        <strong>Direcci√≥n Distribuidor:</strong> ${distributorData.address}
                    </div>
                    
                    <h4 style="margin-bottom: 15px;">Productos:</h4>
                    ${cart.map(item => `
                        <div style="border-bottom: 1px solid #e5e7eb; padding: 10px 0;">
                            <strong>${item.name}</strong> (SKU: ${item.sku})<br>
                            Cantidad: ${item.quantity} √ó ${selectedSymbol}${item.price.toFixed(2)} = ${selectedSymbol}${(item.price * item.quantity).toFixed(2)}
                        </div>
                    `).join('')}
                    
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--herbax-primary);">
                        <div style="font-size: 1.2rem;"><strong>Total: ${selectedSymbol}${total.toFixed(2)} (SIN impuestos)</strong></div>
                        <div style="margin-top: 10px;">
                            <strong>Puntos Calificables:</strong> ${totalQualifyingPoints.toFixed(2)}<br>
                            <strong>Puntos Comisionables:</strong> ${totalCommissionablePoints.toFixed(2)}
                        </div>
                    </div>
                </div>
            `;
        }

        function goToHome() {
            // Resetear todo el formulario
            currentStep = 1;
            selectedCountry = '';
            selectedWarehouse = null;
            selectedDistributor = null;
            cart = [];
            
            // Ocultar todas las pantallas
            document.querySelectorAll('.step-container, .confirmation-screen').forEach(el => {
                el.style.display = 'none';
            });
            
            // Mostrar paso 1
            document.getElementById('step1').style.display = 'block';
            updateProgressBar();
            
            // Limpiar todos los campos
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.value = '';
            });
            
            // Limpiar resultados de b√∫squeda
            document.getElementById('warehouseResults').innerHTML = '';
            document.getElementById('distributorResults').innerHTML = '';
            document.getElementById('productResults').innerHTML = '';
            
            console.log('[v0] Regresando al inicio - formulario reseteado');
        }

        

        function showConfirmationScreen(orderData) {
            // Ocultar paso actual
            document.getElementById('step5').style.display = 'none';
            
            // Generar resumen final
            const totals = orderData.totals;
            const currency = getCurrencySymbol(selectedCountry);
            
            let summaryHTML = `
                <div style="display: grid; gap: 15px;">
                    <div><strong>üåç Pa√≠s:</strong> ${selectedCountry}</div>
                    <div><strong>üè¢ Almac√©n:</strong> ${selectedWarehouse.name}</div>
                    <div><strong>üë§ Distribuidor:</strong> ${selectedDistributor.name} (${selectedDistributor.id})</div>
                    <div><strong>üí≥ M√©todo de Pago:</strong> ${orderData.paymentMethod}</div>
                    
                    <div style="border-top: 2px solid var(--herbax-primary); padding-top: 15px; margin-top: 15px;">
                        <strong>üõí Productos (${cart.length} art√≠culos):</strong>
                        <div style="margin-top: 10px;">
            `;
            
            cart.forEach(item => {
                summaryHTML += `
                    <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px; background: white; border-radius: 5px;">
                        <span>${item.name} (${item.sku})</span>
                        <span>${item.quantity} x ${currency}${item.price.toFixed(2)} = ${currency}${(item.quantity * item.price).toFixed(2)}</span>
                    </div>
                `;
            });
            
            summaryHTML += `
                        </div>
                    </div>
                    
                    <div style="border-top: 2px solid var(--herbax-primary); padding-top: 15px; margin-top: 15px; font-size: 1.1rem;">
                        <div style="display: flex; justify-content: space-between;"><strong>üí∞ Total: ${currency}${totals.total.toFixed(2)}</strong></div>
                        <div style="display: flex; justify-content: space-between; color: var(--herbax-secondary);"><strong>‚≠ê Puntos Calificables: ${totals.totalQualifyingPoints.toFixed(2)}</strong></div>
                        <div style="display: flex; justify-content: space-between; color: var(--herbax-secondary);"><strong>üíé Puntos Comisionables: ${totals.totalCommissionablePoints.toFixed(2)}</strong></div>
                    </div>
                </div>
            `;
            
            document.getElementById('finalOrderSummary').innerHTML = summaryHTML;
            document.getElementById('confirmationScreen').style.display = 'block';
            
            console.log('[v0] Mostrando pantalla de confirmaci√≥n');
        }

        function calculateTotals() {
            let total = 0;
            let totalQualifyingPoints = 0;
            let totalCommissionablePoints = 0;

            cart.forEach(item => {
                total += item.price * item.quantity;
                totalQualifyingPoints += item.qualifyingPoints * item.quantity;
                totalCommissionablePoints += item.commissionablePoints * item.quantity;
            });

            return {
                total: total,
                totalQualifyingPoints: totalQualifyingPoints,
                totalCommissionablePoints: totalCommissionablePoints
            };
        }

        function getCurrencySymbol(countryCode) {
            switch (countryCode) {
                case 'mexico': return '$';
                case 'guatemala': return 'Q';
                case 'usa': return '$';
                default: return '$';
            }
        }

        function showStep(step) {
            // Ocultar todos los pasos
            document.querySelectorAll('.step-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Mostrar paso actual
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // Actualizar barra de progreso
            const progress = (step / 5) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            if (step === 5) {
                updateConfirmationSummary();
                updateSubmitButton();
            }
        }

        function updateConfirmationSummary() {
            // Obtener datos del formulario
            const country = selectedCountry;
            const warehouseName = document.getElementById('warehouseName').value;
            const warehouseCity = document.getElementById('warehouseCity').value;
            const distributorId = document.getElementById('distributorId').value;
            const distributorName = document.getElementById('distributorName').value;
            
            const paymentMethodSelect = document.getElementById('paymentMethod');
            let paymentMethod = paymentMethodSelect.value;
            
            if (country === 'usa') {
                // Para Estados Unidos, seleccionar autom√°ticamente tarjeta bancaria
                paymentMethodSelect.value = 'tarjeta';
                paymentMethod = 'tarjeta';
                // Deshabilitar el dropdown para Estados Unidos
                paymentMethodSelect.disabled = true;
                paymentMethodSelect.style.backgroundColor = '#f5f5f5';
            } else {
                // Para otros pa√≠ses, habilitar el dropdown
                paymentMethodSelect.disabled = false;
                paymentMethodSelect.style.backgroundColor = '';
            }

            // Calcular totales
            let subtotal = 0;
            let qualifyingPoints = 0;
            let commissionablePoints = 0;
            cart.forEach(item => {
                subtotal += item.price * item.quantity;
                qualifyingPoints += item.qualifyingPoints * item.quantity;
                commissionablePoints += item.commissionablePoints * item.quantity;
            });

            let taxRate = 0;
            let taxLabel = '';
            if (country === 'mexico') {
                taxRate = 0.16; // 16% IVA
                taxLabel = 'IVA (16%)';
            } else if (country === 'guatemala') {
                taxRate = 0.12; // 12% IVA
                taxLabel = 'IVA (12%)';
            }
            // Estados Unidos no tiene IVA en este sistema
            
            const taxAmount = subtotal * taxRate;
            const totalWithTax = subtotal + taxAmount;

            let paymentMethodText = '';
            if (paymentMethod === 'referencia') {
                paymentMethodText = 'Referencia Bancaria Santander';
            } else if (paymentMethod === 'deposito') {
                paymentMethodText = 'Dep√≥sito Bancario Banregio';
            } else if (paymentMethod === 'tarjeta') {
                paymentMethodText = 'Tarjeta Bancaria';
            } else {
                paymentMethodText = 'No seleccionado';
            }

            // Crear HTML para el resumen
            let summaryHTML = `
                <h3>Resumen del Pedido</h3>
                <p><strong>Pa√≠s:</strong> ${country}</p>
                <p><strong>Almac√©n:</strong> ${warehouseName}, ${warehouseCity}</p>
                <p><strong>Distribuidor:</strong> ${distributorId} - ${distributorName}</p>
                <p><strong>M√©todo de Pago:</strong> ${paymentMethodText}</p>
                <h4>Productos:</h4>
            `;

            cart.forEach(item => {
                summaryHTML += `
                    <p>${item.name} (SKU: ${item.sku})<br>
                    Cantidad: ${item.quantity} x ${selectedSymbol}${item.price.toFixed(2)} = ${selectedSymbol}${(item.price * item.quantity).toFixed(2)}</p>
                `;
            });

            summaryHTML += `
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                <p><strong>Subtotal (SIN IVA):</strong> ${selectedSymbol}${subtotal.toFixed(2)}</p>
            `;
            
            if (taxRate > 0) {
                summaryHTML += `
                    <p><strong>${taxLabel}:</strong> ${selectedSymbol}${taxAmount.toFixed(2)}</p>
                    <p style="font-size: 18px; font-weight: bold; color: #3fae29;"><strong>Total con IVA:</strong> ${selectedSymbol}${totalWithTax.toFixed(2)}</p>
                `;
            } else {
                summaryHTML += `
                    <p style="font-size: 18px; font-weight: bold; color: #3fae29;"><strong>Total (SIN IVA):</strong> ${selectedSymbol}${subtotal.toFixed(2)}</p>
                `;
            }

            summaryHTML += `
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                <p><strong>Puntos Calificables:</strong> ${qualifyingPoints.toFixed(2)}</p>
                <p><strong>Puntos Comisionables:</strong> ${commissionablePoints.toFixed(2)}</p>
            `;

            // Insertar el resumen en el elemento HTML
            document.getElementById('orderSummary').innerHTML = summaryHTML;
        }

        function updateSubmitButton() {
            const submitButton = document.getElementById('submitOrder');
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (selectedCountry === 'usa' || paymentMethod) {
                submitButton.disabled = false;
                submitButton.style.opacity = '1';
                submitButton.style.cursor = 'pointer';
                console.log("[v0] Submit button enabled");
            } else {
                submitButton.disabled = true;
                submitButton.style.opacity = '0.5';
                submitButton.style.cursor = 'not-allowed';
                console.log("[v0] Submit button disabled");
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log("[v0] DOM loaded, setting up event listeners");
            
            // Event listener para el bot√≥n de enviar pedido
            const submitButton = document.getElementById('submitOrder');
            if (submitButton) {
                submitButton.addEventListener('click', function() {
                    console.log("[v0] Submit button clicked");
                    submitOrder();
                });
                console.log("[v0] Submit button event listener added");
            } else {
                console.log("[v0] Submit button not found");
            }
            
            // Event listener para el dropdown de m√©todo de pago
            const paymentMethodSelect = document.getElementById('paymentMethod');
            if (paymentMethodSelect) {
                paymentMethodSelect.addEventListener('change', function() {
                    console.log("[v0] Payment method changed to:", this.value);
                    updateSubmitButton();
                });
                console.log("[v0] Payment method event listener added");
            } else {
                console.log("[v0] Payment method select not found");
            }
            
            // Inicializar estado del bot√≥n
            updateSubmitButton();
        });

        async function submitOrder() {
            console.log("[v0] submitOrder function called");
            const paymentMethod = document.getElementById('paymentMethod').value;
            console.log("[v0] Payment method:", paymentMethod);
            
            if (!paymentMethod) {
                alert('Por favor selecciona un m√©todo de pago.');
                return;
            }

            if (cart.length === 0) {
                alert('Por favor agrega al menos un producto a tu pedido.');
                return;
            }

            const orderData = {
                timestamp: new Date().toISOString(),
                country: selectedCountry,
                warehouse: selectedWarehouse,
                distributor: selectedDistributor,
                products: cart,
                totals: calculateTotals(),
                paymentMethod: paymentMethod
            };

            console.log("[v0] Order data:", orderData);

            try {
                console.log("[v0] Sending request to webhook");
                const response = await fetch('https://arkamiadorno.app.n8n.cloud/webhook/pedidos-hbx', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                console.log("[v0] Response status:", response.status);
                if (response.ok) {
                    console.log("[v0] Order sent successfully");
                    showConfirmationScreen(orderData);
                } else {
                    console.log("[v0] Error response:", response);
                    alert('Error al enviar el pedido. Por favor intenta nuevamente.');
                }
            } catch (error) {
                console.error('[v0] Error:', error);
                alert('Error al enviar el pedido. Por favor intenta nuevamente.');
            }
        }

    </script>
</body>
</html>
